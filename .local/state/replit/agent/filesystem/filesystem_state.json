{"file_contents":{"README.md":{"content":"# SportOase Buchungssystem\n\nEine Web-Anwendung zur Verwaltung von Buchungen für die Schul-SportOase mit Login-System und E-Mail-Benachrichtigungen.\n\n## Funktionen\n\n- **Benutzer-Authentifizierung**: Login-System für Lehrkräfte und Admins\n- **Wochenplan-Anzeige**: Übersicht über feste und freie Zeitslots\n- **Buchungssystem**: Lehrkräfte können 1-5 Schüler für Zeitslots anmelden\n- **Kapazitätskontrolle**: Maximal 5 Schüler pro Zeitslot\n- **Vorlaufzeit**: Buchungen nur bis 60 Minuten vor Stundenbeginn möglich\n- **E-Mail-Benachrichtigungen**: Automatische Benachrichtigung bei neuen Buchungen\n- **Admin-Panel**: Verwaltung von Lehrkräften und Übersicht aller Buchungen\n\n## Installation auf Replit\n\n### 1. Projekt starten\n\nDas Projekt verwendet Python 3.11 und Flask. Die Abhängigkeiten werden automatisch installiert.\n\n### 2. Datenbank initialisieren\n\nVor der ersten Nutzung muss die Datenbank initialisiert werden:\n\n```bash\npython db_setup.py\n```\n\nDies erstellt:\n- Die SQLite-Datenbank `sportoase.db`\n- Einen Standard-Admin-Account:\n  - **E-Mail**: admin@sportoase.de\n  - **Passwort**: admin123\n\n**WICHTIG**: Ändern Sie das Admin-Passwort nach dem ersten Login!\n\n### 3. Anwendung starten\n\n```bash\npython app.py\n```\n\nDie Anwendung läuft dann auf Port 5000 und ist über den Replit-Webview erreichbar.\n\n## Umgebungsvariablen (Optional)\n\nFür E-Mail-Benachrichtigungen können folgende Umgebungsvariablen in Replit konfiguriert werden:\n\n- `SMTP_HOST`: SMTP-Server-Adresse (z.B. smtp.gmail.com)\n- `SMTP_PORT`: SMTP-Port (Standard: 587)\n- `SMTP_USER`: SMTP-Benutzername\n- `SMTP_PASS`: SMTP-Passwort\n- `SMTP_FROM`: Absender-E-Mail-Adresse\n- `ADMIN_EMAIL`: E-Mail-Adresse für Benachrichtigungen\n\nOhne SMTP-Konfiguration werden Benachrichtigungen nur in der Konsole ausgegeben.\n\n## Projektstruktur\n\n```\n.\n├── app.py                  # Haupt-Anwendung mit allen Routen\n├── config.py               # Konfiguration (Stundenplan, SMTP, etc.)\n├── models.py               # Datenbank-Modelle und Funktionen\n├── db_setup.py             # Datenbank-Initialisierung\n├── email_service.py        # E-Mail-Versand\n├── templates/              # HTML-Templates\n│   ├── base.html          # Basis-Template\n│   ├── login.html         # Login-Seite\n│   ├── dashboard.html     # Hauptseite mit Wochenplan\n│   ├── book.html          # Buchungsformular\n│   └── admin.html         # Admin-Bereich\n├── static/                 # Statische Dateien\n│   └── style.css          # CSS-Stylesheet\n└── README.md              # Diese Datei\n```\n\n## Nutzung\n\n### Als Admin\n\n1. Login mit Admin-Zugangsdaten\n2. Navigieren zum Admin-Bereich\n3. Neue Lehrkräfte anlegen\n4. Alle Buchungen einsehen und filtern\n\n### Als Lehrkraft\n\n1. Login mit eigenen Zugangsdaten\n2. Datum im Dashboard auswählen\n3. Verfügbare Zeitslots mit \"Buchen\" öffnen\n4. Anzahl Schüler auswählen (1-5)\n5. Schülerdaten eingeben (Name und Klasse)\n6. Bei freien Slots: Modul auswählen\n7. Buchung abschließen\n\n## Wochenplan-Struktur\n\nDie SportOase läuft während der Unterrichtszeit (1.-6. Stunde):\n\n- **1. Stunde**: 07:50 - 08:35\n- **2. Stunde**: 08:35 - 09:20\n- **3. Stunde**: 09:40 - 10:25\n- **4. Stunde**: 10:25 - 11:20\n- **5. Stunde**: 11:40 - 12:25\n- **6. Stunde**: 12:25 - 13:10\n\n### Feste Angebote\n\nDie Konfiguration in `config.py` definiert feste Angebote pro Wochentag:\n\n- **Montag**: Stunden 1, 3, 5 fest\n- **Dienstag**: Alle Stunden frei\n- **Mittwoch**: Stunden 1, 3, 5 fest\n- **Donnerstag**: Stunden 2, 5 fest\n- **Freitag**: Stunden 2, 4, 5 fest\n\nFreie Stunden können mit folgenden Modulen gebucht werden:\n- Aktivierung\n- Regulation / Entspannung\n- Konflikt-Reset\n- Egal / flexibel\n\n## Anpassungen\n\n### Stundenplan ändern\n\nIn `config.py` können Sie anpassen:\n\n- `PERIOD_TIMES`: Zeiten der Schulstunden\n- `FIXED_OFFERS`: Feste Angebote pro Wochentag\n- `FREE_MODULES`: Verfügbare Module für freie Stunden\n- `MAX_STUDENTS_PER_PERIOD`: Maximale Schüleranzahl\n- `BOOKING_ADVANCE_MINUTES`: Vorlaufzeit für Buchungen\n\n### Datenbank zurücksetzen\n\nUm die Datenbank komplett zurückzusetzen:\n\n```bash\nrm sportoase.db\npython db_setup.py\n```\n\n## Technologie-Stack\n\n- **Backend**: Python 3.11, Flask\n- **Datenbank**: SQLite\n- **Templates**: Jinja2\n- **Styling**: Einfaches CSS (schwarz-weiß)\n- **E-Mail**: SMTP (smtplib)\n- **Zeitzone**: Europe/Berlin (pytz)\n\n## Support\n\nBei Fragen oder Problemen wenden Sie sich an Ihren Administrator.\n","size_bytes":4493},"models.py":{"content":"# Datenbankmodelle für die SportOase-Anwendung mit Flask-SQLAlchemy\n# Diese Datei definiert die Struktur der Datenbank-Tabellen für PostgreSQL\n\nfrom werkzeug.security import generate_password_hash, check_password_hash\nfrom datetime import datetime\nimport json\nfrom database import db\n\nclass User(db.Model):\n    \"\"\"Benutzer-Modell für Lehrkräfte und Admins\"\"\"\n    __tablename__ = 'users'\n    \n    id = db.Column(db.Integer, primary_key=True)\n    username = db.Column(db.String(64), unique=True, nullable=False, index=True)\n    email = db.Column(db.String(120))\n    password_hash = db.Column(db.String(256), nullable=False)\n    role = db.Column(db.String(20), nullable=False)\n    \n    bookings = db.relationship('Booking', backref='teacher', lazy=True)\n    \n    def set_password(self, password):\n        \"\"\"Setzt das Passwort (gehasht)\"\"\"\n        self.password_hash = generate_password_hash(password)\n    \n    def check_password(self, password):\n        \"\"\"Überprüft das Passwort\"\"\"\n        return check_password_hash(self.password_hash, password)\n    \n    def to_dict(self):\n        \"\"\"Konvertiert User zu Dictionary für Kompatibilität\"\"\"\n        return {\n            'id': self.id,\n            'username': self.username,\n            'email': self.email,\n            'password_hash': self.password_hash,\n            'role': self.role\n        }\n\nclass Booking(db.Model):\n    \"\"\"Buchungs-Modell\"\"\"\n    __tablename__ = 'bookings'\n    \n    id = db.Column(db.Integer, primary_key=True)\n    date = db.Column(db.String(10), nullable=False, index=True)\n    weekday = db.Column(db.String(3), nullable=False)\n    period = db.Column(db.Integer, nullable=False)\n    teacher_id = db.Column(db.Integer, db.ForeignKey('users.id'), nullable=False)\n    teacher_name = db.Column(db.String(100))\n    teacher_class = db.Column(db.String(50))\n    students_json = db.Column(db.Text, nullable=False)\n    offer_type = db.Column(db.String(10), nullable=False)\n    offer_label = db.Column(db.String(100), nullable=False)\n    created_at = db.Column(db.DateTime, nullable=False, default=datetime.utcnow)\n    \n    def to_dict(self):\n        \"\"\"Konvertiert Booking zu Dictionary für Kompatibilität\"\"\"\n        return {\n            'id': self.id,\n            'date': self.date,\n            'weekday': self.weekday,\n            'period': self.period,\n            'teacher_id': self.teacher_id,\n            'teacher_name': self.teacher_name,\n            'teacher_class': self.teacher_class,\n            'students_json': self.students_json,\n            'offer_type': self.offer_type,\n            'offer_label': self.offer_label,\n            'created_at': self.created_at.isoformat() if isinstance(self.created_at, datetime) else self.created_at,\n            'teacher_email': self.teacher.email if self.teacher else None\n        }\n\nclass SlotName(db.Model):\n    \"\"\"Modell für anpassbare Slot-Namen\"\"\"\n    __tablename__ = 'slot_names'\n    \n    id = db.Column(db.Integer, primary_key=True)\n    weekday = db.Column(db.String(3), nullable=False)\n    period = db.Column(db.Integer, nullable=False)\n    label = db.Column(db.String(200), nullable=False)\n    \n    __table_args__ = (\n        db.UniqueConstraint('weekday', 'period', name='unique_weekday_period'),\n    )\n    \n    def to_dict(self):\n        \"\"\"Konvertiert SlotName zu Dictionary\"\"\"\n        return {\n            'id': self.id,\n            'weekday': self.weekday,\n            'period': self.period,\n            'label': self.label\n        }\n\nclass BlockedSlot(db.Model):\n    \"\"\"Modell für von Admins blockierte Slots (z.B. für Beratungsgespräche)\"\"\"\n    __tablename__ = 'blocked_slots'\n    \n    id = db.Column(db.Integer, primary_key=True)\n    date = db.Column(db.String(10), nullable=False, index=True)\n    weekday = db.Column(db.String(3), nullable=False)\n    period = db.Column(db.Integer, nullable=False)\n    reason = db.Column(db.String(200), default='Beratung')\n    blocked_by = db.Column(db.Integer, db.ForeignKey('users.id'), nullable=False)\n    created_at = db.Column(db.DateTime, nullable=False, default=datetime.utcnow)\n    \n    __table_args__ = (\n        db.UniqueConstraint('date', 'period', name='unique_date_period_block'),\n    )\n    \n    def to_dict(self):\n        \"\"\"Konvertiert BlockedSlot zu Dictionary\"\"\"\n        return {\n            'id': self.id,\n            'date': self.date,\n            'weekday': self.weekday,\n            'period': self.period,\n            'reason': self.reason,\n            'blocked_by': self.blocked_by,\n            'created_at': self.created_at.isoformat() if isinstance(self.created_at, datetime) else self.created_at\n        }\n\n# Hilfsfunktionen für Kompatibilität mit dem alten Code\n\ndef create_user(username, password, role, email=None):\n    \"\"\"Erstellt einen neuen Benutzer in der Datenbank\"\"\"\n    try:\n        user = User(username=username, email=email, role=role)\n        user.set_password(password)\n        db.session.add(user)\n        db.session.commit()\n        return user.id\n    except Exception as e:\n        db.session.rollback()\n        print(f\"Fehler beim Erstellen des Benutzers: {e}\")\n        return None\n\ndef get_user_by_username(username):\n    \"\"\"Sucht einen Benutzer anhand des Benutzernamens\"\"\"\n    user = User.query.filter_by(username=username).first()\n    return user.to_dict() if user else None\n\ndef get_user_by_email(email):\n    \"\"\"Sucht einen Benutzer anhand der E-Mail-Adresse\"\"\"\n    user = User.query.filter_by(email=email).first()\n    return user.to_dict() if user else None\n\ndef get_user_by_id(user_id):\n    \"\"\"Sucht einen Benutzer anhand der ID\"\"\"\n    user = User.query.get(user_id)\n    return user.to_dict() if user else None\n\ndef verify_password(user_dict, password):\n    \"\"\"Überprüft, ob das eingegebene Passwort korrekt ist\"\"\"\n    user = User.query.get(user_dict['id'])\n    return user.check_password(password) if user else False\n\ndef get_all_users():\n    \"\"\"Gibt alle Benutzer zurück (für Admin-Ansicht)\"\"\"\n    users = User.query.order_by(User.role, User.username).all()\n    return [u.to_dict() for u in users]\n\ndef create_booking(date, weekday, period, teacher_id, students, offer_type, offer_label, teacher_name=None, teacher_class=None):\n    \"\"\"Erstellt eine neue Buchung in der Datenbank\"\"\"\n    try:\n        students_json = json.dumps(students, ensure_ascii=False)\n        booking = Booking(\n            date=date,\n            weekday=weekday,\n            period=period,\n            teacher_id=teacher_id,\n            teacher_name=teacher_name,\n            teacher_class=teacher_class,\n            students_json=students_json,\n            offer_type=offer_type,\n            offer_label=offer_label,\n            created_at=datetime.now()\n        )\n        db.session.add(booking)\n        db.session.commit()\n        return booking.id\n    except Exception as e:\n        db.session.rollback()\n        print(f\"Fehler beim Erstellen der Buchung: {e}\")\n        return None\n\ndef get_bookings_for_date_period(date, period):\n    \"\"\"Gibt alle Buchungen für ein bestimmtes Datum und Stunde zurück\"\"\"\n    bookings = Booking.query.filter_by(date=date, period=period).order_by(Booking.created_at).all()\n    return [b.to_dict() for b in bookings]\n\ndef count_students_for_period(date, period):\n    \"\"\"Zählt die Gesamtzahl der Schüler für eine bestimmte Stunde\"\"\"\n    bookings = get_bookings_for_date_period(date, period)\n    total = 0\n    for booking in bookings:\n        students = json.loads(booking['students_json'])\n        total += len(students)\n    return total\n\ndef get_all_bookings():\n    \"\"\"Gibt alle Buchungen zurück (für Admin-Ansicht)\"\"\"\n    bookings = Booking.query.order_by(Booking.date.desc(), Booking.period).all()\n    return [b.to_dict() for b in bookings]\n\ndef get_bookings_by_date(date):\n    \"\"\"Gibt alle Buchungen für ein bestimmtes Datum zurück\"\"\"\n    bookings = Booking.query.filter_by(date=date).order_by(Booking.period).all()\n    return [b.to_dict() for b in bookings]\n\ndef get_bookings_for_week(start_date, end_date):\n    \"\"\"Gibt alle Buchungen für eine Woche zurück\"\"\"\n    bookings = Booking.query.filter(Booking.date >= start_date, Booking.date <= end_date).order_by(Booking.date, Booking.period).all()\n    return [b.to_dict() for b in bookings]\n\ndef get_booking_by_id(booking_id):\n    \"\"\"Gibt eine einzelne Buchung anhand der ID zurück\"\"\"\n    booking = Booking.query.get(booking_id)\n    return booking.to_dict() if booking else None\n\ndef update_booking(booking_id, date, weekday, period, teacher_id, students, offer_type, offer_label, teacher_name=None, teacher_class=None):\n    \"\"\"Aktualisiert eine bestehende Buchung in der Datenbank\"\"\"\n    try:\n        booking = Booking.query.get(booking_id)\n        if not booking:\n            return False\n        \n        booking.date = date\n        booking.weekday = weekday\n        booking.period = period\n        booking.teacher_id = teacher_id\n        booking.teacher_name = teacher_name\n        booking.teacher_class = teacher_class\n        booking.students_json = json.dumps(students, ensure_ascii=False)\n        booking.offer_type = offer_type\n        booking.offer_label = offer_label\n        \n        db.session.commit()\n        return True\n    except Exception as e:\n        db.session.rollback()\n        print(f\"Fehler beim Aktualisieren der Buchung: {e}\")\n        return False\n\ndef delete_booking(booking_id):\n    \"\"\"Löscht eine Buchung aus der Datenbank\"\"\"\n    try:\n        booking = Booking.query.get(booking_id)\n        if not booking:\n            return False\n        \n        db.session.delete(booking)\n        db.session.commit()\n        return True\n    except Exception as e:\n        db.session.rollback()\n        print(f\"Fehler beim Löschen der Buchung: {e}\")\n        return False\n\ndef get_custom_slot_name(weekday, period):\n    \"\"\"Gibt den angepassten Slot-Namen aus der Datenbank zurück\"\"\"\n    slot = SlotName.query.filter_by(weekday=weekday, period=period).first()\n    return slot.label if slot else None\n\ndef update_slot_name(weekday, period, label):\n    \"\"\"Aktualisiert oder erstellt einen angepassten Slot-Namen\"\"\"\n    try:\n        slot = SlotName.query.filter_by(weekday=weekday, period=period).first()\n        if slot:\n            slot.label = label\n        else:\n            slot = SlotName(weekday=weekday, period=period, label=label)\n            db.session.add(slot)\n        \n        db.session.commit()\n        return True\n    except Exception as e:\n        db.session.rollback()\n        print(f\"Fehler beim Aktualisieren des Slot-Namens: {e}\")\n        return False\n\ndef get_all_custom_slot_names():\n    \"\"\"Gibt alle angepassten Slot-Namen zurück\"\"\"\n    slots = SlotName.query.all()\n    return [s.to_dict() for s in slots]\n\ndef is_slot_blocked(date, period):\n    \"\"\"Prüft, ob ein Slot für ein bestimmtes Datum und Stunde blockiert ist\"\"\"\n    blocked = BlockedSlot.query.filter_by(date=date, period=period).first()\n    return blocked is not None\n\ndef get_blocked_slot(date, period):\n    \"\"\"Gibt den blockierten Slot zurück, falls vorhanden\"\"\"\n    blocked = BlockedSlot.query.filter_by(date=date, period=period).first()\n    return blocked.to_dict() if blocked else None\n\ndef block_slot(date, weekday, period, admin_id, reason='Beratung'):\n    \"\"\"Blockiert einen Slot für Beratungsgespräche (nur Admin)\"\"\"\n    try:\n        if is_slot_blocked(date, period):\n            return False\n        \n        blocked = BlockedSlot(\n            date=date,\n            weekday=weekday,\n            period=period,\n            reason=reason,\n            blocked_by=admin_id,\n            created_at=datetime.now()\n        )\n        db.session.add(blocked)\n        db.session.commit()\n        return True\n    except Exception as e:\n        db.session.rollback()\n        print(f\"Fehler beim Blockieren des Slots: {e}\")\n        return False\n\ndef unblock_slot(date, period):\n    \"\"\"Gibt einen blockierten Slot wieder frei\"\"\"\n    try:\n        blocked = BlockedSlot.query.filter_by(date=date, period=period).first()\n        if not blocked:\n            return False\n        \n        db.session.delete(blocked)\n        db.session.commit()\n        return True\n    except Exception as e:\n        db.session.rollback()\n        print(f\"Fehler beim Freigeben des Slots: {e}\")\n        return False\n\ndef get_blocked_slots_for_date(date):\n    \"\"\"Gibt alle blockierten Slots für ein bestimmtes Datum zurück\"\"\"\n    blocked_slots = BlockedSlot.query.filter_by(date=date).all()\n    return [b.to_dict() for b in blocked_slots]\n\ndef get_blocked_slots_for_week(start_date, end_date):\n    \"\"\"Gibt alle blockierten Slots für eine Woche zurück\"\"\"\n    blocked_slots = BlockedSlot.query.filter(BlockedSlot.date >= start_date, BlockedSlot.date <= end_date).all()\n    return [b.to_dict() for b in blocked_slots]\n\ndef get_all_blocked_slots():\n    \"\"\"Gibt alle blockierten Slots zurück (für Admin-Ansicht)\"\"\"\n    blocked_slots = BlockedSlot.query.order_by(BlockedSlot.date.desc(), BlockedSlot.period).all()\n    return [b.to_dict() for b in blocked_slots]\n","size_bytes":12942},"app.py":{"content":"# Haupt-Anwendungsdatei für die SportOase-Buchungssystem\n# Diese Datei enthält alle Routen (URLs) und die Logik der Webanwendung\n\nfrom flask import Flask, render_template, request, redirect, url_for, session, flash\nfrom datetime import datetime, timedelta, date\nfrom werkzeug.middleware.proxy_fix import ProxyFix\nimport pytz\nimport json\nimport os\n\n# Flask-App erstellen\napp = Flask(__name__)\napp.secret_key = os.environ.get('SESSION_SECRET', 'dev-secret-key-change-in-production')\napp.wsgi_app = ProxyFix(app.wsgi_app, x_proto=1, x_host=1)\n\n# CSRF-Token Generierung und Validierung\nimport secrets\n\ndef generate_csrf_token():\n    \"\"\"Generiert ein CSRF-Token und speichert es in der Session\"\"\"\n    if 'csrf_token' not in session:\n        session['csrf_token'] = secrets.token_hex(32)\n    return session['csrf_token']\n\ndef validate_csrf_token(token):\n    \"\"\"Validiert das CSRF-Token\"\"\"\n    return token == session.get('csrf_token')\n\n@app.context_processor\ndef inject_csrf_token():\n    \"\"\"Macht csrf_token in allen Templates verfügbar\"\"\"\n    return dict(csrf_token=generate_csrf_token())\n\n# Datenbank-Konfiguration\ndb_uri = os.environ.get(\"DATABASE_URL\") or os.environ.get(\"SQLALCHEMY_DATABASE_URI\")\n\nprint(\"DEBUG DATABASE_URL:\", os.environ.get(\"DATABASE_URL\"))\nprint(\"DEBUG SQLALCHEMY_DATABASE_URI env:\", os.environ.get(\"SQLALCHEMY_DATABASE_URI\"))\nprint(\"DEBUG final DB URI:\", db_uri)\n\nif not db_uri:\n    raise RuntimeError(\n        \"Keine DB-URL gefunden. Bitte in Render DATABASE_URL \"\n        \"oder SQLALCHEMY_DATABASE_URI setzen.\"\n    )\n\napp.config[\"SQLALCHEMY_DATABASE_URI\"] = db_uri\napp.config[\"SQLALCHEMY_ENGINE_OPTIONS\"] = {\n    \"pool_recycle\": 300,\n    \"pool_pre_ping\": True,\n}\napp.config[\"SQLALCHEMY_TRACK_MODIFICATIONS\"] = False\n\n# Importiere zentrale Datenbank-Instanz\nfrom database import db\n\n# Initialisiere SQLAlchemy mit der App\ndb.init_app(app)\n\n# Importiere Modelle und Hilfsfunktionen\nfrom models import (\n    create_user, get_user_by_username, get_user_by_email, \n    get_user_by_id, verify_password, get_all_users, create_booking,\n    get_bookings_for_date_period, count_students_for_period, get_all_bookings,\n    get_bookings_by_date, get_bookings_for_week, get_booking_by_id,\n    update_booking, delete_booking, User, Booking\n)\nfrom config import *\nfrom email_service import send_booking_notification\n\n# Schema-Erstellung erfolgt explizit über db_setup.py\n# Nicht automatisch bei jedem Import!\n\n# Hilfsfunktion: Zeitzone Europe/Berlin\ndef get_berlin_tz():\n    \"\"\"Gibt die Zeitzone Europe/Berlin zurück\"\"\"\n    return pytz.timezone('Europe/Berlin')\n\n# Hilfsfunktion: Prüft, ob Benutzer eingeloggt ist\ndef login_required(f):\n    \"\"\"Decorator-Funktion: Schützt Routen, sodass nur eingeloggte Benutzer darauf zugreifen können\"\"\"\n    from functools import wraps\n    @wraps(f)\n    def decorated_function(*args, **kwargs):\n        if 'user_id' not in session:\n            flash('Bitte melden Sie sich an.', 'error')\n            return redirect(url_for('login'))\n        return f(*args, **kwargs)\n    return decorated_function\n\n# Hilfsfunktion: Prüft, ob Benutzer Admin ist\ndef admin_required(f):\n    \"\"\"Decorator-Funktion: Schützt Routen, sodass nur Admins darauf zugreifen können\"\"\"\n    from functools import wraps\n    @wraps(f)\n    def decorated_function(*args, **kwargs):\n        if 'user_id' not in session:\n            flash('Bitte melden Sie sich an.', 'error')\n            return redirect(url_for('login'))\n        user = get_user_by_id(session['user_id'])\n        if not user or user['role'] != 'admin':\n            flash('Zugriff verweigert. Nur Admins haben Zugriff.', 'error')\n            return redirect(url_for('dashboard'))\n        return f(*args, **kwargs)\n    return decorated_function\n\n# Hilfsfunktion: Gibt Informationen über eine Stunde zurück\ndef get_period_info(weekday, period):\n    \"\"\"\n    Gibt Informationen über eine Stunde zurück (fest/frei, Bezeichnung)\n    weekday: z.B. \"Mon\", \"Tue\", ...\n    period: 1-6\n    \"\"\"\n    from models import get_custom_slot_name\n    \n    if weekday in FIXED_OFFERS and period in FIXED_OFFERS[weekday]:\n        custom_label = get_custom_slot_name(weekday, period)\n        label = custom_label if custom_label else FIXED_OFFERS[weekday][period]\n        return {\n            'type': 'fest',\n            'label': label\n        }\n    else:\n        return {\n            'type': 'frei',\n            'label': 'Freie Wahl'\n        }\n\n# Hilfsfunktion: Prüft, ob ein Datum in der Vergangenheit liegt\ndef is_past_date(check_date, period=None):\n    \"\"\"\n    Prüft, ob ein Datum (und optional eine Stunde) in der Vergangenheit liegt\n    \"\"\"\n    berlin_tz = get_berlin_tz()\n    now = datetime.now(berlin_tz)\n    \n    if period is not None:\n        # Prüfe mit spezifischer Stunde\n        period_start_time = PERIOD_TIMES[period]['start']\n        hour, minute = map(int, period_start_time.split(':'))\n        period_datetime = berlin_tz.localize(\n            datetime.combine(check_date, datetime.min.time()).replace(hour=hour, minute=minute)\n        )\n        return period_datetime < now\n    else:\n        # Prüfe nur Datum\n        today = now.date()\n        return check_date < today\n\n# Hilfsfunktion: Prüft, ob eine Buchung zeitlich möglich ist\ndef check_booking_time(booking_date, period):\n    \"\"\"\n    Prüft, ob die Buchung mindestens 60 Minuten in der Zukunft liegt\n    Gibt (True, None) zurück wenn OK, sonst (False, Fehlermeldung)\n    \"\"\"\n    berlin_tz = get_berlin_tz()\n    now = datetime.now(berlin_tz)\n    \n    # Erstelle Datetime-Objekt für den Stundenbeginn\n    period_start_time = PERIOD_TIMES[period]['start']\n    hour, minute = map(int, period_start_time.split(':'))\n    \n    # Kombiniere Datum und Zeit\n    period_datetime = berlin_tz.localize(\n        datetime.combine(booking_date, datetime.min.time()).replace(hour=hour, minute=minute)\n    )\n    \n    # Berechne Zeitdifferenz\n    time_diff = period_datetime - now\n    \n    if time_diff.total_seconds() < BOOKING_ADVANCE_MINUTES * 60:\n        return False, f\"Buchungen sind nur bis {BOOKING_ADVANCE_MINUTES} Minuten vor Stundenbeginn möglich.\"\n    \n    return True, None\n\n# Route: Startseite (leitet zum Dashboard weiter)\n@app.route('/')\ndef index():\n    \"\"\"Startseite - leitet zum Dashboard oder Login weiter\"\"\"\n    if 'user_id' in session:\n        return redirect(url_for('dashboard'))\n    return redirect(url_for('login'))\n\n# Route: Login-Seite\n@app.route('/login', methods=['GET', 'POST'])\ndef login():\n    \"\"\"Login-Seite für Lehrkräfte und Admins\"\"\"\n    if request.method == 'POST':\n        username = request.form.get('username', '').strip()\n        password = request.form.get('password', '')\n        \n        # Suche Benutzer in Datenbank\n        user = get_user_by_username(username)\n        \n        if user and verify_password(user, password):\n            # Login erfolgreich - speichere in Session\n            session['user_id'] = user['id']\n            session['user_username'] = user['username']\n            session['user_email'] = user['email'] if user['email'] else ''\n            session['user_role'] = user['role']\n            flash(f'Willkommen, {username}!', 'success')\n            return redirect(url_for('dashboard'))\n        else:\n            flash('Ungültiger Benutzername oder Passwort.', 'error')\n    \n    return render_template('login.html')\n\n# Route: Logout\n@app.route('/logout')\ndef logout():\n    \"\"\"Meldet den Benutzer ab\"\"\"\n    session.clear()\n    flash('Sie wurden abgemeldet.', 'info')\n    return redirect(url_for('login'))\n\n# Route: Dashboard\n@app.route('/dashboard')\n@login_required\ndef dashboard():\n    \"\"\"Hauptseite - zeigt Wochenplan und Buchungsmöglichkeiten\"\"\"\n    # Hole aktuelles Datum oder gewähltes Datum\n    selected_date_str = request.args.get('date', datetime.now(get_berlin_tz()).strftime('%Y-%m-%d'))\n    \n    try:\n        selected_date = datetime.strptime(selected_date_str, '%Y-%m-%d').date()\n    except:\n        selected_date = datetime.now(get_berlin_tz()).date()\n    \n    # Wochentag ermitteln (Mon, Tue, ...)\n    weekday = selected_date.strftime('%a')\n    weekday_name = selected_date.strftime('%A')  # Ausgeschriebener Name\n    \n    # Deutsche Wochentagsnamen\n    weekday_names_de = {\n        'Monday': 'Montag',\n        'Tuesday': 'Dienstag',\n        'Wednesday': 'Mittwoch',\n        'Thursday': 'Donnerstag',\n        'Friday': 'Freitag',\n        'Saturday': 'Samstag',\n        'Sunday': 'Sonntag'\n    }\n    weekday_name_de = weekday_names_de.get(weekday_name, weekday_name)\n    \n    # Erstelle Stundenplan für den Tag\n    from models import is_slot_blocked, get_blocked_slot\n    schedule = []\n    for period in range(1, 7):\n        period_info = get_period_info(weekday, period)\n        student_count = count_students_for_period(selected_date_str, period)\n        available = MAX_STUDENTS_PER_PERIOD - student_count\n        \n        # Prüfe, ob Slot blockiert ist\n        blocked_slot = get_blocked_slot(selected_date_str, period)\n        is_blocked = blocked_slot is not None\n        \n        # Prüfe, ob Termin in der Vergangenheit liegt\n        is_past = is_past_date(selected_date, period)\n        \n        # Prüfe, ob Buchung zeitlich möglich ist\n        can_book, time_message = check_booking_time(selected_date, period)\n        \n        # can_book muss False sein für vergangene Termine\n        if is_past:\n            can_book = False\n            if not time_message:\n                time_message = \"Dieser Termin liegt in der Vergangenheit.\"\n        \n        schedule.append({\n            'period': period,\n            'time': f\"{PERIOD_TIMES[period]['start']} - {PERIOD_TIMES[period]['end']}\",\n            'type': period_info['type'],\n            'label': period_info['label'],\n            'booked': student_count,\n            'available': available,\n            'can_book': can_book and available > 0 and not is_blocked and not is_past,\n            'time_message': time_message,\n            'blocked': blocked_slot,\n            'blocked_reason': blocked_slot.get('reason', 'Beratung') if blocked_slot else None,\n            'is_past': is_past\n        })\n    \n    # Erstelle Wochenübersicht (Montag-Freitag) mit Buchungsdaten\n    from models import get_bookings_for_week, get_blocked_slots_for_week, is_slot_blocked\n    \n    # Berechne Montag und Freitag der aktuellen Woche\n    days_since_monday = selected_date.weekday()\n    monday = selected_date - timedelta(days=days_since_monday)\n    friday = monday + timedelta(days=4)\n    \n    # Hole alle Buchungen für diese Woche\n    week_bookings = get_bookings_for_week(monday.strftime('%Y-%m-%d'), friday.strftime('%Y-%m-%d'))\n    \n    # Hole alle blockierten Slots für diese Woche\n    blocked_slots = get_blocked_slots_for_week(monday.strftime('%Y-%m-%d'), friday.strftime('%Y-%m-%d'))\n    \n    # Organisiere blockierte Slots nach Datum und Stunde\n    blocked_by_date_period = {}\n    for blocked in blocked_slots:\n        key = f\"{blocked['date']}_{blocked['period']}\"\n        blocked_by_date_period[key] = blocked\n    \n    # Organisiere Buchungen nach Datum und Stunde\n    bookings_by_date_period = {}\n    for booking in week_bookings:\n        booking_dict = dict(booking)\n        key = f\"{booking_dict['date']}_{booking_dict['period']}\"\n        if key not in bookings_by_date_period:\n            bookings_by_date_period[key] = []\n        \n        students = json.loads(booking_dict['students_json']) if booking_dict.get('students_json') else []\n        bookings_by_date_period[key].append({\n            'teacher_name': booking_dict.get('teacher_name', 'N/A'),\n            'teacher_class': booking_dict.get('teacher_class', 'N/A'),\n            'student_count': len(students),\n            'students': students,\n            'offer_label': booking_dict.get('offer_label', 'N/A')\n        })\n    \n    week_overview = []\n    weekdays = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri']\n    weekday_names = ['Mo', 'Di', 'Mi', 'Do', 'Fr']\n    \n    for i, wd in enumerate(weekdays):\n        day_date = monday + timedelta(days=i)\n        day_date_str = day_date.strftime('%Y-%m-%d')\n        \n        day_schedule = []\n        for period in range(1, 7):\n            info = get_period_info(wd, period)\n            key = f\"{day_date_str}_{period}\"\n            period_bookings = bookings_by_date_period.get(key, [])\n            blocked_slot = blocked_by_date_period.get(key)\n            \n            total_students = sum(b['student_count'] for b in period_bookings)\n            available = MAX_STUDENTS_PER_PERIOD - total_students\n            \n            # Prüfe, ob Termin in der Vergangenheit liegt\n            is_past = is_past_date(day_date, period)\n            \n            # Prüfe, ob Buchung für diesen Slot möglich ist\n            can_book, _ = check_booking_time(day_date, period)\n            can_book = can_book and available > 0 and not blocked_slot and not is_past\n            \n            day_schedule.append({\n                'period': period,\n                'type': info['type'],\n                'label': info['label'],\n                'bookings': period_bookings,\n                'total_students': total_students,\n                'available': available,\n                'can_book': can_book,\n                'blocked': blocked_slot,\n                'blocked_reason': blocked_slot.get('reason', 'Beratung') if blocked_slot else None,\n                'is_past': is_past\n            })\n        week_overview.append({\n            'weekday': wd,\n            'name': weekday_names[i],\n            'date': day_date_str,\n            'date_formatted': day_date.strftime('%d.%m.'),\n            'schedule': day_schedule\n        })\n    \n    return render_template('dashboard.html',\n                         selected_date=selected_date,\n                         weekday=weekday_name_de,\n                         schedule=schedule,\n                         week_overview=week_overview,\n                         user_role=session.get('user_role'))\n\n# Route: Buchungsseite\n@app.route('/book/<date_str>/<int:period>', methods=['GET', 'POST'])\n@login_required\ndef book(date_str, period):\n    \"\"\"Seite zum Erstellen einer neuen Buchung\"\"\"\n    \n    # Validiere Datum und Stunde\n    try:\n        booking_date = datetime.strptime(date_str, '%Y-%m-%d').date()\n    except:\n        flash('Ungültiges Datum.', 'error')\n        return redirect(url_for('dashboard'))\n    \n    if period < 1 or period > 6:\n        flash('Ungültige Stunde.', 'error')\n        return redirect(url_for('dashboard'))\n    \n    # Prüfe, ob Termin in der Vergangenheit liegt\n    if is_past_date(booking_date, period):\n        flash('Dieser Termin liegt in der Vergangenheit und kann nicht gebucht werden.', 'error')\n        return redirect(url_for('dashboard'))\n    \n    # Ermittle Wochentag und Stundeninfo\n    weekday = booking_date.strftime('%a')\n    period_info = get_period_info(weekday, period)\n    \n    # Prüfe verfügbare Plätze\n    current_students = count_students_for_period(date_str, period)\n    available_spots = MAX_STUDENTS_PER_PERIOD - current_students\n    \n    if available_spots <= 0:\n        flash('Diese Stunde ist bereits voll belegt.', 'error')\n        return redirect(url_for('dashboard', date=date_str))\n    \n    # Prüfe, ob Slot für Beratung blockiert ist (nur Admins können blockierte Slots sehen)\n    from models import is_slot_blocked, get_blocked_slot\n    if is_slot_blocked(date_str, period):\n        blocked_info = get_blocked_slot(date_str, period)\n        reason = blocked_info.get('reason', 'Beratung') if blocked_info else 'Beratung'\n        flash(f'Dieser Slot ist für {reason} blockiert und kann nicht gebucht werden.', 'error')\n        return redirect(url_for('dashboard', date=date_str))\n    \n    # Prüfe Zeitfenster\n    can_book, time_message = check_booking_time(booking_date, period)\n    if not can_book:\n        flash(time_message or 'Buchung nicht möglich.', 'error')\n        return redirect(url_for('dashboard', date=date_str))\n    \n    if request.method == 'POST':\n        # Hole Lehrkraft-Informationen\n        teacher_name = request.form.get('teacher_name', '').strip()\n        teacher_class = request.form.get('teacher_class', '').strip()\n        \n        if not teacher_name or not teacher_class:\n            flash('Bitte geben Sie Ihren Namen und Ihre Klasse ein.', 'error')\n            return render_template('book.html', \n                                 date_str=date_str,\n                                 period=period,\n                                 period_info=period_info,\n                                 period_time=PERIOD_TIMES[period],\n                                 available_spots=available_spots,\n                                 free_modules=FREE_MODULES)\n        \n        # Hole Anzahl der Schüler\n        num_students = int(request.form.get('num_students', 1))\n        \n        if num_students < 1 or num_students > 5:\n            flash('Bitte wählen Sie zwischen 1 und 5 Schülern.', 'error')\n            return render_template('book.html', \n                                 date_str=date_str,\n                                 period=period,\n                                 period_info=period_info,\n                                 period_time=PERIOD_TIMES[period],\n                                 available_spots=available_spots,\n                                 free_modules=FREE_MODULES)\n        \n        # Prüfe erneut verfügbare Plätze\n        if num_students > available_spots:\n            flash(f'Nicht genug Plätze verfügbar. Nur noch {available_spots} Plätze frei.', 'error')\n            return redirect(url_for('dashboard', date=date_str))\n        \n        # Sammle Schülerdaten\n        students = []\n        for i in range(num_students):\n            name = request.form.get(f'student_name_{i}', '').strip()\n            klasse = request.form.get(f'student_class_{i}', '').strip()\n            \n            if not name or not klasse:\n                flash('Bitte füllen Sie alle Schülerfelder aus.', 'error')\n                return render_template('book.html', \n                                     date_str=date_str,\n                                     period=period,\n                                     period_info=period_info,\n                                     period_time=PERIOD_TIMES[period],\n                                     available_spots=available_spots,\n                                     free_modules=FREE_MODULES)\n            \n            students.append({'name': name, 'klasse': klasse})\n        \n        # Hole Modul-Wahl (nur bei freien Stunden)\n        if period_info['type'] == 'frei':\n            selected_module = request.form.get('module', '')\n            if selected_module not in FREE_MODULES:\n                flash('Bitte wählen Sie ein Modul.', 'error')\n                return render_template('book.html', \n                                     date_str=date_str,\n                                     period=period,\n                                     period_info=period_info,\n                                     period_time=PERIOD_TIMES[period],\n                                     available_spots=available_spots,\n                                     free_modules=FREE_MODULES)\n            offer_label = selected_module\n        else:\n            offer_label = period_info['label']\n        \n        # Erstelle Buchung in Datenbank\n        booking_id = create_booking(\n            date=date_str,\n            weekday=weekday,\n            period=period,\n            teacher_id=session['user_id'],\n            students=students,\n            offer_type=period_info['type'],\n            offer_label=offer_label,\n            teacher_name=teacher_name,\n            teacher_class=teacher_class\n        )\n        \n        if booking_id:\n            # Sende E-Mail-Benachrichtigung\n            booking_data = {\n                'date': date_str,\n                'weekday': weekday,\n                'period': period,\n                'students': students,\n                'offer_type': period_info['type'],\n                'offer_label': offer_label,\n                'teacher_name': teacher_name,\n                'teacher_class': teacher_class\n            }\n            send_booking_notification(booking_data, session.get('user_email', 'system'))\n            \n            flash(f'Buchung erfolgreich! {len(students)} Schüler für {offer_label} angemeldet.', 'success')\n            return redirect(url_for('dashboard', date=date_str))\n        else:\n            flash('Fehler beim Erstellen der Buchung.', 'error')\n    \n    return render_template('book.html',\n                         date_str=date_str,\n                         period=period,\n                         period_info=period_info,\n                         period_time=PERIOD_TIMES[period],\n                         available_spots=available_spots,\n                         free_modules=FREE_MODULES)\n\n# Route: Admin-Bereich\n@app.route('/admin', methods=['GET', 'POST'])\n@admin_required\ndef admin():\n    \"\"\"Admin-Seite für Benutzerverwaltung und Buchungsübersicht\"\"\"\n    \n    if request.method == 'POST':\n        # Neue Lehrkraft anlegen\n        username = request.form.get('username', '').strip()\n        password = request.form.get('password', '')\n        email = request.form.get('email', '').strip()\n        \n        if not username or not password:\n            flash('Bitte füllen Sie alle Felder aus.', 'error')\n        else:\n            user_id = create_user(username, password, 'teacher', email if email else None)\n            if user_id:\n                flash(f'Lehrkraft {username} erfolgreich angelegt.', 'success')\n            else:\n                flash('Benutzername existiert bereits.', 'error')\n    \n    # Hole alle Benutzer\n    users = get_all_users()\n    \n    # Hole alle Buchungen\n    filter_date = request.args.get('filter_date', '')\n    if filter_date:\n        bookings = get_bookings_by_date(filter_date)\n    else:\n        bookings = get_all_bookings()\n    \n    # Konvertiere Buchungen für Anzeige\n    bookings_display = []\n    for booking in bookings:\n        booking_dict = dict(booking)\n        students = json.loads(booking_dict['students_json']) if booking_dict.get('students_json') else []\n        bookings_display.append({\n            'id': booking_dict['id'],\n            'date': booking_dict['date'],\n            'weekday': booking_dict['weekday'],\n            'period': booking_dict['period'],\n            'teacher_email': booking_dict['teacher_email'],\n            'teacher_name': booking_dict.get('teacher_name', 'N/A'),\n            'teacher_class': booking_dict.get('teacher_class', 'N/A'),\n            'offer_label': booking_dict['offer_label'],\n            'offer_type': booking_dict['offer_type'],\n            'students': students,\n            'student_count': len(students)\n        })\n    \n    return render_template('admin.html',\n                         users=users,\n                         bookings=bookings_display,\n                         filter_date=filter_date)\n\n# Route: Buchung erstellen (nur Admin)\n@app.route('/admin/create_booking', methods=['GET', 'POST'])\n@admin_required\ndef admin_create_booking():\n    \"\"\"Admin kann Buchungen für beliebige Lehrkräfte erstellen\"\"\"\n    from models import get_booking_by_id\n    \n    if request.method == 'POST':\n        date_str = request.form.get('date', '').strip()\n        \n        try:\n            period = int(request.form.get('period', 1))\n            teacher_id = int(request.form.get('teacher_id', 0))\n            num_students = int(request.form.get('num_students', 1))\n        except (ValueError, TypeError):\n            flash('Ungültige Eingabe für Stunde, Lehrkraft oder Schüleranzahl.', 'error')\n            users = get_all_users()\n            return render_template('admin_edit_booking.html',\n                                 booking=None,\n                                 users=users,\n                                 free_modules=FREE_MODULES,\n                                 period_times=PERIOD_TIMES)\n        \n        teacher_name = request.form.get('teacher_name', '').strip()\n        teacher_class = request.form.get('teacher_class', '').strip()\n        \n        if not date_str or not teacher_id or not teacher_name or not teacher_class or num_students < 1 or num_students > 5:\n            flash('Bitte füllen Sie alle Pflichtfelder aus und wählen Sie 1-5 Schüler.', 'error')\n            users = get_all_users()\n            return render_template('admin_edit_booking.html',\n                                 booking=None,\n                                 users=users,\n                                 free_modules=FREE_MODULES,\n                                 period_times=PERIOD_TIMES)\n        \n        try:\n            booking_date = datetime.strptime(date_str, '%Y-%m-%d').date()\n        except:\n            flash('Ungültiges Datum.', 'error')\n            users = get_all_users()\n            return render_template('admin_edit_booking.html',\n                                 booking=None,\n                                 users=users,\n                                 free_modules=FREE_MODULES,\n                                 period_times=PERIOD_TIMES)\n        \n        weekday = booking_date.strftime('%a')\n        period_info = get_period_info(weekday, period)\n        \n        # Prüfe Kapazität vor dem Erstellen der Buchung\n        current_students = count_students_for_period(date_str, period)\n        available_spots = MAX_STUDENTS_PER_PERIOD - current_students\n        \n        if num_students > available_spots:\n            flash(f'Nicht genug Plätze verfügbar. Nur noch {available_spots} Plätze frei.', 'error')\n            users = get_all_users()\n            return render_template('admin_edit_booking.html',\n                                 booking=None,\n                                 users=users,\n                                 free_modules=FREE_MODULES,\n                                 period_times=PERIOD_TIMES)\n        \n        students = []\n        for i in range(num_students):\n            name = request.form.get(f'student_name_{i}', '').strip()\n            klasse = request.form.get(f'student_class_{i}', '').strip()\n            \n            if not name or not klasse:\n                flash('Bitte füllen Sie alle Schülerfelder aus.', 'error')\n                users = get_all_users()\n                return render_template('admin_edit_booking.html',\n                                     booking=None,\n                                     users=users,\n                                     free_modules=FREE_MODULES,\n                                     period_times=PERIOD_TIMES)\n            \n            students.append({'name': name, 'klasse': klasse})\n        \n        if period_info['type'] == 'frei':\n            selected_module = request.form.get('module', '')\n            if selected_module not in FREE_MODULES:\n                flash('Bitte wählen Sie ein Modul.', 'error')\n                users = get_all_users()\n                return render_template('admin_edit_booking.html',\n                                     booking=None,\n                                     users=users,\n                                     free_modules=FREE_MODULES,\n                                     period_times=PERIOD_TIMES)\n            offer_label = selected_module\n        else:\n            offer_label = period_info['label']\n        \n        booking_id = create_booking(\n            date=date_str,\n            weekday=weekday,\n            period=period,\n            teacher_id=teacher_id,\n            students=students,\n            offer_type=period_info['type'],\n            offer_label=offer_label,\n            teacher_name=teacher_name,\n            teacher_class=teacher_class\n        )\n        \n        if booking_id:\n            flash(f'Buchung erfolgreich erstellt! {len(students)} Schüler für {offer_label} angemeldet.', 'success')\n            return redirect(url_for('admin'))\n        else:\n            flash('Fehler beim Erstellen der Buchung.', 'error')\n    \n    users = get_all_users()\n    return render_template('admin_edit_booking.html',\n                         booking=None,\n                         users=users,\n                         free_modules=FREE_MODULES,\n                         period_times=PERIOD_TIMES)\n\n# Route: Buchung bearbeiten (nur Admin)\n@app.route('/admin/edit_booking/<int:booking_id>', methods=['GET', 'POST'])\n@admin_required\ndef admin_edit_booking(booking_id):\n    \"\"\"Admin kann bestehende Buchungen bearbeiten\"\"\"\n    from models import get_booking_by_id, update_booking\n    \n    booking_row = get_booking_by_id(booking_id)\n    if not booking_row:\n        flash('Buchung nicht gefunden.', 'error')\n        return redirect(url_for('admin'))\n    \n    booking = dict(booking_row)\n    \n    if request.method == 'POST':\n        date_str = request.form.get('date', '').strip()\n        \n        try:\n            period = int(request.form.get('period', 1))\n            teacher_id = int(request.form.get('teacher_id', 0))\n            num_students = int(request.form.get('num_students', 1))\n        except (ValueError, TypeError):\n            flash('Ungültige Eingabe für Stunde, Lehrkraft oder Schüleranzahl.', 'error')\n            users = get_all_users()\n            students = json.loads(booking['students_json']) if booking.get('students_json') else []\n            booking_display = dict(booking)\n            booking_display['students'] = students\n            return render_template('admin_edit_booking.html',\n                                 booking=booking_display,\n                                 users=users,\n                                 free_modules=FREE_MODULES,\n                                 period_times=PERIOD_TIMES)\n        \n        teacher_name = request.form.get('teacher_name', '').strip()\n        teacher_class = request.form.get('teacher_class', '').strip()\n        \n        if not date_str or not teacher_id or not teacher_name or not teacher_class or num_students < 1 or num_students > 5:\n            flash('Bitte füllen Sie alle Pflichtfelder aus und wählen Sie 1-5 Schüler.', 'error')\n            users = get_all_users()\n            students = json.loads(booking['students_json']) if booking.get('students_json') else []\n            booking_display = dict(booking)\n            booking_display['students'] = students\n            return render_template('admin_edit_booking.html',\n                                 booking=booking_display,\n                                 users=users,\n                                 free_modules=FREE_MODULES,\n                                 period_times=PERIOD_TIMES)\n        \n        try:\n            booking_date = datetime.strptime(date_str, '%Y-%m-%d').date()\n        except:\n            flash('Ungültiges Datum.', 'error')\n            users = get_all_users()\n            students = json.loads(booking['students_json']) if booking.get('students_json') else []\n            booking_display = dict(booking)\n            booking_display['students'] = students\n            return render_template('admin_edit_booking.html',\n                                 booking=booking_display,\n                                 users=users,\n                                 free_modules=FREE_MODULES,\n                                 period_times=PERIOD_TIMES)\n        \n        weekday = booking_date.strftime('%a')\n        period_info = get_period_info(weekday, period)\n        \n        # Prüfe Kapazität: Berechne verfügbare Plätze ohne die aktuelle Buchung\n        current_students = count_students_for_period(date_str, period)\n        old_booking_students = len(json.loads(booking['students_json']) if booking.get('students_json') else [])\n        available_spots = MAX_STUDENTS_PER_PERIOD - (current_students - old_booking_students)\n        \n        if num_students > available_spots:\n            flash(f'Nicht genug Plätze verfügbar. Nur noch {available_spots} Plätze frei.', 'error')\n            users = get_all_users()\n            students = json.loads(booking['students_json']) if booking.get('students_json') else []\n            booking_display = dict(booking)\n            booking_display['students'] = students\n            return render_template('admin_edit_booking.html',\n                                 booking=booking_display,\n                                 users=users,\n                                 free_modules=FREE_MODULES,\n                                 period_times=PERIOD_TIMES)\n        \n        students = []\n        for i in range(num_students):\n            name = request.form.get(f'student_name_{i}', '').strip()\n            klasse = request.form.get(f'student_class_{i}', '').strip()\n            \n            if not name or not klasse:\n                flash('Bitte füllen Sie alle Schülerfelder aus.', 'error')\n                users = get_all_users()\n                students = json.loads(booking['students_json']) if booking.get('students_json') else []\n                booking_display = dict(booking)\n                booking_display['students'] = students\n                return render_template('admin_edit_booking.html',\n                                     booking=booking_display,\n                                     users=users,\n                                     free_modules=FREE_MODULES,\n                                     period_times=PERIOD_TIMES)\n            \n            students.append({'name': name, 'klasse': klasse})\n        \n        if period_info['type'] == 'frei':\n            selected_module = request.form.get('module', '')\n            if selected_module not in FREE_MODULES:\n                flash('Bitte wählen Sie ein Modul.', 'error')\n                users = get_all_users()\n                students = json.loads(booking['students_json']) if booking.get('students_json') else []\n                booking_display = dict(booking)\n                booking_display['students'] = students\n                return render_template('admin_edit_booking.html',\n                                     booking=booking_display,\n                                     users=users,\n                                     free_modules=FREE_MODULES,\n                                     period_times=PERIOD_TIMES)\n            offer_label = selected_module\n        else:\n            offer_label = period_info['label']\n        \n        if update_booking(\n            booking_id=booking_id,\n            date=date_str,\n            weekday=weekday,\n            period=period,\n            teacher_id=teacher_id,\n            students=students,\n            offer_type=period_info['type'],\n            offer_label=offer_label,\n            teacher_name=teacher_name,\n            teacher_class=teacher_class\n        ):\n            flash(f'Buchung erfolgreich aktualisiert!', 'success')\n            return redirect(url_for('admin'))\n        else:\n            flash('Fehler beim Aktualisieren der Buchung.', 'error')\n    \n    users = get_all_users()\n    students = json.loads(booking['students_json']) if booking.get('students_json') else []\n    booking_display = dict(booking)\n    booking_display['students'] = students\n    \n    return render_template('admin_edit_booking.html',\n                         booking=booking_display,\n                         users=users,\n                         free_modules=FREE_MODULES,\n                         period_times=PERIOD_TIMES)\n\n# Route: Buchung löschen (nur Admin)\n@app.route('/admin/delete_booking/<int:booking_id>', methods=['POST'])\n@admin_required\ndef delete_booking_route(booking_id):\n    \"\"\"Löscht eine Buchung\"\"\"\n    from models import delete_booking\n    \n    if delete_booking(booking_id):\n        flash('Buchung erfolgreich gelöscht.', 'success')\n    else:\n        flash('Buchung konnte nicht gelöscht werden.', 'error')\n    \n    return redirect(url_for('admin'))\n\n# Route: Slots verwalten (nur Admin)\n@app.route('/admin/manage_slots', methods=['GET', 'POST'])\n@admin_required\ndef manage_slots():\n    \"\"\"Admin kann feste Slot-Namen umbenennen\"\"\"\n    from models import update_slot_name\n    \n    if request.method == 'POST':\n        weekday = request.form.get('weekday')\n        period = int(request.form.get('period'))\n        label = request.form.get('label', '').strip()\n        \n        if weekday and period and label:\n            if update_slot_name(weekday, period, label):\n                flash(f'Slot-Name erfolgreich aktualisiert!', 'success')\n            else:\n                flash('Fehler beim Aktualisieren des Slot-Namens.', 'error')\n        else:\n            flash('Bitte füllen Sie alle Felder aus.', 'error')\n        \n        return redirect(url_for('manage_slots'))\n    \n    fixed_slots = []\n    weekdays = {\n        'Mon': 'Montag',\n        'Tue': 'Dienstag', \n        'Wed': 'Mittwoch',\n        'Thu': 'Donnerstag',\n        'Fri': 'Freitag'\n    }\n    \n    for weekday_code, weekday_name in weekdays.items():\n        if weekday_code in FIXED_OFFERS:\n            for period, default_label in FIXED_OFFERS[weekday_code].items():\n                period_info = get_period_info(weekday_code, period)\n                fixed_slots.append({\n                    'weekday_code': weekday_code,\n                    'weekday_name': weekday_name,\n                    'period': period,\n                    'period_time': f\"{PERIOD_TIMES[period]['start']} - {PERIOD_TIMES[period]['end']}\",\n                    'default_label': default_label,\n                    'current_label': period_info['label']\n                })\n    \n    return render_template('admin_manage_slots.html', \n                         fixed_slots=fixed_slots)\n\n@app.route('/admin/block_slot', methods=['POST'])\n@admin_required\ndef admin_block_slot():\n    \"\"\"Admin blockiert einen Slot für Beratungsgespräche\"\"\"\n    from models import block_slot, is_slot_blocked\n    \n    # CSRF-Token Validierung\n    csrf_token = request.form.get('csrf_token', '')\n    if not validate_csrf_token(csrf_token):\n        flash('Ungültiges Sicherheits-Token. Bitte versuchen Sie es erneut.', 'error')\n        return redirect(request.referrer or url_for('dashboard'))\n    \n    date_str = request.form.get('date', '').strip()\n    period = request.form.get('period', type=int)\n    reason = request.form.get('reason', 'Beratung').strip()\n    \n    # Validiere Grund-Länge\n    if reason and len(reason) > 200:\n        reason = reason[:200]\n    \n    if not date_str or not period:\n        flash('Ungültige Slot-Daten.', 'error')\n        return redirect(request.referrer or url_for('dashboard'))\n    \n    try:\n        booking_date = datetime.strptime(date_str, '%Y-%m-%d').date()\n        weekday = booking_date.strftime('%a')\n    except:\n        flash('Ungültiges Datum.', 'error')\n        return redirect(request.referrer or url_for('dashboard'))\n    \n    if is_slot_blocked(date_str, period):\n        flash('Dieser Slot ist bereits blockiert.', 'warning')\n    else:\n        admin_id = session.get('user_id')\n        if block_slot(date_str, weekday, period, admin_id, reason):\n            flash(f'Slot erfolgreich für {reason} blockiert.', 'success')\n        else:\n            flash('Fehler beim Blockieren des Slots.', 'error')\n    \n    return redirect(request.referrer or url_for('dashboard'))\n\n@app.route('/admin/unblock_slot', methods=['POST'])\n@admin_required\ndef admin_unblock_slot():\n    \"\"\"Admin gibt einen blockierten Slot wieder frei\"\"\"\n    from models import unblock_slot\n    \n    # CSRF-Token Validierung\n    csrf_token = request.form.get('csrf_token', '')\n    if not validate_csrf_token(csrf_token):\n        flash('Ungültiges Sicherheits-Token. Bitte versuchen Sie es erneut.', 'error')\n        return redirect(request.referrer or url_for('dashboard'))\n    \n    date_str = request.form.get('date', '').strip()\n    period = request.form.get('period', type=int)\n    \n    if not date_str or not period:\n        flash('Ungültige Slot-Daten.', 'error')\n        return redirect(request.referrer or url_for('dashboard'))\n    \n    if unblock_slot(date_str, period):\n        flash('Slot erfolgreich freigegeben.', 'success')\n    else:\n        flash('Fehler beim Freigeben des Slots.', 'error')\n    \n    return redirect(request.referrer or url_for('dashboard'))\n\nif __name__ == '__main__':\n    # Starte die Anwendung\n    app.run(host='0.0.0.0', port=5000, debug=True)\n","size_bytes":40164},"pyproject.toml":{"content":"[project]\nname = \"repl-nix-workspace\"\nversion = \"0.1.0\"\ndescription = \"Add your description here\"\nrequires-python = \">=3.11\"\ndependencies = [\n    \"email-validator>=2.3.0\",\n    \"flask>=3.1.2\",\n    \"flask-sqlalchemy>=3.1.1\",\n    \"gunicorn>=23.0.0\",\n    \"psycopg2-binary>=2.9.11\",\n    \"pytz>=2025.2\",\n    \"werkzeug>=3.1.3\",\n]\n","size_bytes":323},"email_service.py":{"content":"# E-Mail-Service für Buchungsbenachrichtigungen\n# Sendet E-Mails über SMTP an Admins und Lehrkräfte\n\nimport smtplib\nfrom email.mime.text import MIMEText\nfrom email.mime.multipart import MIMEMultipart\nfrom config import SMTP_HOST, SMTP_PORT, SMTP_USER, SMTP_PASS, SMTP_FROM, ADMIN_EMAIL\nimport json\n\ndef send_booking_notification(booking_data, teacher_email):\n    \"\"\"\n    Sendet eine E-Mail-Benachrichtigung über eine neue Buchung\n    \n    booking_data: Dictionary mit Buchungsinformationen\n    teacher_email: E-Mail-Adresse der Lehrkraft\n    \"\"\"\n    \n    # Wenn SMTP nicht konfiguriert ist, Nachricht nur ausgeben\n    if not SMTP_USER or not SMTP_PASS or SMTP_HOST == 'smtp.example.com':\n        print(\"\\n=== E-Mail-Benachrichtigung (SMTP nicht konfiguriert) ===\")\n        print(f\"An: {ADMIN_EMAIL}\")\n        print(f\"Betreff: Neue SportOase-Buchung für {booking_data['date']}\")\n        print(f\"\\nDatum: {booking_data['date']}\")\n        print(f\"Stunde: {booking_data['period']}\")\n        print(f\"Angebot: {booking_data['offer_label']} ({booking_data['offer_type']})\")\n        print(f\"Lehrkraft: {booking_data.get('teacher_name', 'N/A')} (Klasse {booking_data.get('teacher_class', 'N/A')})\")\n        print(f\"Schüler:\")\n        for student in booking_data['students']:\n            print(f\"  - {student['name']} (Klasse {student['klasse']})\")\n        print(\"=\" * 50 + \"\\n\")\n        return True\n    \n    try:\n        # E-Mail-Inhalt erstellen\n        students_list = \"\\n\".join([\n            f\"  - {s['name']} (Klasse {s['klasse']})\" \n            for s in booking_data['students']\n        ])\n        \n        subject = f\"Neue SportOase-Buchung für {booking_data['date']}\"\n        body = f\"\"\"\nNeue Buchung in der SportOase:\n\nDatum: {booking_data['date']} ({booking_data['weekday']})\nStunde: {booking_data['period']}. Stunde\nAngebot: {booking_data['offer_label']} ({booking_data['offer_type']})\nLehrkraft: {booking_data.get('teacher_name', 'N/A')} (Klasse {booking_data.get('teacher_class', 'N/A')})\n\nAngemeldete Schüler:\n{students_list}\n\nAnzahl Schüler: {len(booking_data['students'])}\n\n---\nDiese E-Mail wurde automatisch vom SportOase-Buchungssystem generiert.\n\"\"\"\n        \n        # E-Mail an Admin senden\n        msg = MIMEMultipart()\n        msg['From'] = SMTP_FROM\n        msg['To'] = ADMIN_EMAIL\n        msg['Subject'] = subject\n        msg.attach(MIMEText(body, 'plain', 'utf-8'))\n        \n        # SMTP-Verbindung aufbauen und E-Mail senden\n        server = smtplib.SMTP(SMTP_HOST, SMTP_PORT)\n        server.starttls()\n        server.login(SMTP_USER, SMTP_PASS)\n        server.send_message(msg)\n        server.quit()\n        \n        print(f\"E-Mail-Benachrichtigung an {ADMIN_EMAIL} gesendet.\")\n        \n        # Optional: Bestätigung an Lehrkraft senden\n        send_teacher_confirmation(booking_data, teacher_email)\n        \n        return True\n        \n    except Exception as e:\n        print(f\"Fehler beim E-Mail-Versand: {e}\")\n        return False\n\ndef send_teacher_confirmation(booking_data, teacher_email):\n    \"\"\"Sendet eine Bestätigung an die Lehrkraft\"\"\"\n    \n    if not SMTP_USER or not SMTP_PASS or SMTP_HOST == 'smtp.example.com':\n        return  # SMTP nicht konfiguriert\n    \n    try:\n        students_list = \"\\n\".join([\n            f\"  - {s['name']} (Klasse {s['klasse']})\" \n            for s in booking_data['students']\n        ])\n        \n        subject = f\"Buchungsbestätigung SportOase - {booking_data['date']}\"\n        body = f\"\"\"\nIhre Buchung wurde erfolgreich registriert:\n\nDatum: {booking_data['date']} ({booking_data['weekday']})\nStunde: {booking_data['period']}. Stunde\nAngebot: {booking_data['offer_label']}\n\nAngemeldete Schüler:\n{students_list}\n\nVielen Dank für Ihre Buchung!\n\n---\nDiese E-Mail wurde automatisch vom SportOase-Buchungssystem generiert.\n\"\"\"\n        \n        msg = MIMEMultipart()\n        msg['From'] = SMTP_FROM\n        msg['To'] = teacher_email\n        msg['Subject'] = subject\n        msg.attach(MIMEText(body, 'plain', 'utf-8'))\n        \n        server = smtplib.SMTP(SMTP_HOST, SMTP_PORT)\n        server.starttls()\n        server.login(SMTP_USER, SMTP_PASS)\n        server.send_message(msg)\n        server.quit()\n        \n        print(f\"Bestätigungs-E-Mail an {teacher_email} gesendet.\")\n        \n    except Exception as e:\n        print(f\"Fehler beim Versand der Bestätigung: {e}\")\n","size_bytes":4352},"static/style.css":{"content":"/* \n   SportOase Buchungssystem - Stylesheet\n   Design: Modern mit Logo-Farben (Blau, Sand, Grün)\n*/\n\n:root {\n    --blue-sky: #5DADE2;\n    --blue-dark: #3498DB;\n    --sand: #E8B86D;\n    --sand-light: #F5E6D3;\n    --green: #7FB069;\n    --orange: #FF9500;\n    --dark: #2C3E50;\n    --gray: #7F8C8D;\n    --light-gray: #ECF0F1;\n    --white: #FFFFFF;\n    --shadow: rgba(0, 0, 0, 0.1);\n}\n\n/* Grundlegende Styles */\n* {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n}\n\nbody {\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    line-height: 1.6;\n    color: var(--dark);\n    background-color: var(--light-gray);\n    padding-top: 0;\n    margin: 0;\n}\n\n.container {\n    max-width: 1200px;\n    margin: 0 auto;\n    padding: 0 20px;\n}\n\n/* Top Navigation */\n.top-nav {\n    background: linear-gradient(135deg, var(--blue-sky) 0%, var(--blue-dark) 100%);\n    padding: 1rem 0;\n    box-shadow: 0 2px 10px var(--shadow);\n    margin-bottom: 2rem;\n}\n\n.top-nav nav {\n    display: flex;\n    gap: 1rem;\n    justify-content: flex-end;\n}\n\n.top-nav nav a {\n    color: var(--white);\n    text-decoration: none;\n    padding: 0.6rem 1.2rem;\n    border: 2px solid var(--white);\n    border-radius: 8px;\n    transition: all 0.3s;\n    font-weight: 600;\n    font-size: 1rem;\n}\n\n.top-nav nav a:hover {\n    background-color: var(--white);\n    color: var(--blue-dark);\n    transform: translateY(-2px);\n    box-shadow: 0 4px 8px rgba(0,0,0,0.2);\n}\n\n/* Main Content */\nmain {\n    min-height: 70vh;\n    padding: 2rem 0;\n    margin-top: 0;\n}\n\nh2 {\n    font-size: 2rem;\n    margin-bottom: 1.5rem;\n    color: var(--dark);\n    border-bottom: 3px solid var(--blue-sky);\n    padding-bottom: 0.5rem;\n}\n\nh3 {\n    font-size: 1.5rem;\n    margin: 1.5rem 0 1rem 0;\n    color: var(--dark);\n}\n\nh4 {\n    font-size: 1.2rem;\n    margin: 1rem 0 0.5rem 0;\n    color: var(--dark);\n}\n\n/* Nachrichten / Flash Messages */\n.messages {\n    margin-bottom: 1.5rem;\n}\n\n.message {\n    padding: 1rem 1.5rem;\n    margin-bottom: 1rem;\n    border-radius: 8px;\n    font-weight: 500;\n    box-shadow: 0 2px 5px var(--shadow);\n}\n\n.message-success {\n    background-color: var(--green);\n    color: var(--white);\n    border-left: 5px solid #5A8A50;\n}\n\n.message-error {\n    background-color: #E74C3C;\n    color: var(--white);\n    border-left: 5px solid #C0392B;\n}\n\n.message-info {\n    background-color: var(--blue-sky);\n    color: var(--white);\n    border-left: 5px solid var(--blue-dark);\n}\n\n/* Formulare */\n.form-group {\n    margin-bottom: 1.2rem;\n}\n\n.form-group label {\n    display: block;\n    margin-bottom: 0.5rem;\n    font-weight: 600;\n    color: var(--dark);\n}\n\n.form-group input,\n.form-group select {\n    width: 100%;\n    padding: 0.8rem;\n    font-size: 1rem;\n    border: 2px solid var(--gray);\n    border-radius: 8px;\n    background-color: var(--white);\n    transition: all 0.3s;\n}\n\n.form-group input:focus,\n.form-group select:focus {\n    outline: none;\n    border-color: var(--blue-sky);\n    box-shadow: 0 0 0 3px rgba(93, 173, 226, 0.2);\n}\n\n.form-group input::placeholder {\n    color: var(--gray);\n}\n\n/* Buttons */\n.btn {\n    display: inline-block;\n    padding: 0.8rem 1.5rem;\n    text-decoration: none;\n    border: none;\n    border-radius: 8px;\n    font-weight: 600;\n    cursor: pointer;\n    transition: all 0.3s;\n    font-size: 1rem;\n}\n\n.btn:hover {\n    transform: translateY(-2px);\n    box-shadow: 0 4px 12px var(--shadow);\n}\n\n.btn-primary {\n    background-color: var(--blue-sky);\n    color: var(--white);\n}\n\n.btn-primary:hover {\n    background-color: var(--blue-dark);\n}\n\n.btn-secondary {\n    background-color: var(--gray);\n    color: var(--white);\n}\n\n.btn-secondary:hover {\n    background-color: #5D6D7E;\n}\n\n.btn-delete {\n    background-color: #E74C3C;\n    color: var(--white);\n    padding: 0.5rem 1rem;\n    font-size: 0.9rem;\n}\n\n.btn-delete:hover {\n    background-color: #C0392B;\n}\n\n.disabled {\n    color: var(--gray);\n    font-style: italic;\n}\n\n/* Login-Seite */\n.login-container {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    min-height: 70vh;\n    background: linear-gradient(135deg, var(--blue-sky) 0%, var(--blue-dark) 50%, var(--green) 100%);\n    margin: -2rem 0;\n    padding: 3rem 0;\n}\n\n.login-box {\n    border: none;\n    padding: 3rem;\n    max-width: 500px;\n    width: 100%;\n    background-color: var(--white);\n    border-radius: 20px;\n    box-shadow: 0 10px 40px rgba(0,0,0,0.3);\n    animation: fadeIn 0.5s ease-in;\n}\n\n@keyframes fadeIn {\n    from {\n        opacity: 0;\n        transform: translateY(-20px);\n    }\n    to {\n        opacity: 1;\n        transform: translateY(0);\n    }\n}\n\n.login-logo {\n    text-align: center;\n    margin-bottom: 2rem;\n}\n\n.login-logo img {\n    width: 150px;\n    height: 150px;\n    border-radius: 50%;\n    border: 5px solid var(--blue-sky);\n    box-shadow: 0 5px 20px rgba(0,0,0,0.2);\n    background: var(--white);\n}\n\n.login-box h2 {\n    text-align: center;\n    color: var(--dark);\n    font-size: 2.2rem;\n    margin-bottom: 2rem;\n    border-bottom: none;\n}\n\n.login-box .form-group input {\n    padding: 1rem;\n    font-size: 1.1rem;\n    border: 2px solid var(--light-gray);\n    transition: all 0.3s;\n}\n\n.login-box .form-group input:focus {\n    border-color: var(--blue-sky);\n    box-shadow: 0 0 0 4px rgba(93, 173, 226, 0.15);\n    transform: translateY(-2px);\n}\n\n.login-box .btn-primary {\n    width: 100%;\n    padding: 1.2rem;\n    font-size: 1.2rem;\n    font-weight: 700;\n    text-transform: uppercase;\n    letter-spacing: 1px;\n    background: linear-gradient(135deg, var(--blue-sky) 0%, var(--blue-dark) 100%);\n    border: none;\n    margin-top: 1rem;\n}\n\n.login-box .btn-primary:hover {\n    background: linear-gradient(135deg, var(--blue-dark) 0%, var(--blue-sky) 100%);\n    transform: translateY(-3px);\n    box-shadow: 0 8px 20px rgba(93, 173, 226, 0.4);\n}\n\n.login-info {\n    margin-top: 2rem;\n    padding: 1.2rem;\n    border-radius: 10px;\n    background: linear-gradient(135deg, var(--sand-light) 0%, #FFF8E7 100%);\n    border: 2px solid var(--sand);\n    font-size: 0.95rem;\n    color: var(--dark);\n}\n\n.login-info p {\n    margin: 0.5rem 0;\n}\n\n.login-info strong {\n    color: var(--blue-dark);\n    font-size: 1.05rem;\n}\n\n/* Dashboard */\n.dashboard {\n    animation: fadeIn 0.6s ease-in;\n}\n\n.date-selector {\n    margin-bottom: 2rem;\n    padding: 1.5rem 2rem;\n    background: linear-gradient(135deg, rgba(93, 173, 226, 0.1) 0%, rgba(127, 176, 105, 0.1) 100%);\n    border-radius: 15px;\n    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);\n    border: 2px solid rgba(93, 173, 226, 0.2);\n    display: flex;\n    align-items: center;\n    gap: 1rem;\n}\n\n.date-selector label {\n    font-weight: 700;\n    font-size: 1.1rem;\n    color: var(--dark);\n}\n\n.date-selector input {\n    padding: 0.9rem 1.2rem;\n    border: 2px solid var(--blue-sky);\n    border-radius: 10px;\n    font-size: 1.05rem;\n    font-weight: 600;\n    background: var(--white);\n    transition: all 0.3s;\n    cursor: pointer;\n}\n\n.date-selector input:hover {\n    border-color: var(--blue-dark);\n    box-shadow: 0 0 0 4px rgba(93, 173, 226, 0.15);\n    transform: translateY(-2px);\n}\n\n.selected-date-info {\n    margin-bottom: 2rem;\n}\n\n.selected-date-info h3 {\n    background: linear-gradient(135deg, var(--blue-sky) 0%, var(--blue-dark) 100%);\n    color: var(--white);\n    padding: 1.5rem 2rem;\n    margin: 0;\n    border-radius: 15px;\n    text-align: center;\n    font-size: 1.8rem;\n    box-shadow: 0 6px 20px rgba(93, 173, 226, 0.3);\n    letter-spacing: 0.5px;\n}\n\n/* Wochenübersicht */\n.week-overview {\n    margin-bottom: 3rem;\n    background: var(--white);\n    padding: 2rem;\n    border-radius: 20px;\n    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);\n    border: 1px solid rgba(93, 173, 226, 0.1);\n}\n\n.week-overview h3 {\n    color: var(--blue-dark);\n    font-size: 1.8rem;\n    margin-bottom: 1.5rem;\n    padding-bottom: 1rem;\n    border-bottom: 3px solid var(--blue-sky);\n}\n\n.week-table {\n    width: 100%;\n    border-collapse: separate;\n    border-spacing: 0;\n    margin-top: 1rem;\n    overflow: hidden;\n    border-radius: 12px;\n}\n\n.week-table th,\n.week-table td {\n    border: 1px solid #E0E0E0;\n    padding: 1rem;\n    text-align: center;\n    vertical-align: top;\n}\n\n.week-table th {\n    background: linear-gradient(135deg, var(--blue-dark) 0%, var(--blue-sky) 100%);\n    color: var(--white);\n    font-weight: 700;\n    font-size: 0.95rem;\n    padding: 1.2rem 0.8rem;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n.week-table th:first-child {\n    border-top-left-radius: 12px;\n}\n\n.week-table th:last-child {\n    border-top-right-radius: 12px;\n}\n\n.week-day-header {\n    display: flex;\n    flex-direction: column;\n    gap: 0.4rem;\n}\n\n.day-name {\n    font-size: 1.2rem;\n    font-weight: 800;\n    text-transform: uppercase;\n    letter-spacing: 1px;\n}\n\n.day-date {\n    font-size: 0.9rem;\n    opacity: 0.95;\n    font-weight: 500;\n}\n\n.week-table td {\n    font-size: 0.9rem;\n    min-height: 100px;\n    transition: all 0.3s;\n}\n\n.week-table td:hover {\n    transform: scale(1.02);\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n}\n\n.period-header {\n    font-weight: 700;\n    margin-bottom: 0.8rem;\n    padding: 0.6rem 0.8rem;\n    border-radius: 8px;\n    font-size: 0.9rem;\n    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);\n}\n\n.period-fest .period-header {\n    background: linear-gradient(135deg, var(--sand) 0%, var(--sand-light) 100%);\n    color: var(--dark);\n    border: 2px solid var(--sand);\n}\n\n.period-frei .period-header {\n    background: linear-gradient(135deg, var(--green) 0%, #A8D5BA 100%);\n    color: var(--white);\n    border: 2px solid var(--green);\n}\n\n.booking-info {\n    margin-top: 0.8rem;\n    padding: 0.8rem;\n    background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(240, 248, 255, 0.9) 100%);\n    border-radius: 8px;\n    font-size: 0.85rem;\n    text-align: left;\n    border-left: 4px solid var(--blue-sky);\n    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);\n}\n\n.booking-info strong {\n    color: var(--blue-dark);\n    font-size: 0.9rem;\n}\n\n.period-fest {\n    background: linear-gradient(135deg, #FFF8E7 0%, #FFFBF0 100%);\n    border-left: 5px solid var(--sand);\n}\n\n.period-frei {\n    background: linear-gradient(135deg, #F0F9F4 0%, #F8FDF9 100%);\n    border-left: 5px solid var(--green);\n}\n\n/* Klickbare Slots in der Wochenübersicht */\n.clickable-slot {\n    cursor: pointer;\n    transition: all 0.3s ease;\n}\n\n.clickable-slot:hover {\n    transform: scale(1.05);\n    box-shadow: 0 6px 20px rgba(93, 173, 226, 0.3);\n    border: 2px solid var(--blue-sky);\n}\n\n.slot-link {\n    display: block;\n    text-decoration: none;\n    color: inherit;\n    width: 100%;\n    height: 100%;\n    position: relative;\n    z-index: 1;\n    cursor: pointer;\n}\n\n.slot-link:hover .period-header {\n    transform: translateY(-2px);\n}\n\n/* Ensure nested elements don't block clicks */\n.slot-link > * {\n    pointer-events: none;\n}\n\n.slot-link {\n    pointer-events: auto;\n}\n\n.booking-action {\n    margin-top: 0.8rem;\n    padding: 0.6rem;\n    background: linear-gradient(135deg, var(--blue-sky) 0%, var(--blue-dark) 100%);\n    color: var(--white);\n    border-radius: 8px;\n    text-align: center;\n    font-weight: 600;\n    box-shadow: 0 2px 8px rgba(93, 173, 226, 0.3);\n}\n\n.booking-full {\n    margin-top: 0.8rem;\n    padding: 0.6rem;\n    background: linear-gradient(135deg, #E74C3C 0%, #C0392B 100%);\n    color: var(--white);\n    border-radius: 8px;\n    text-align: center;\n    font-style: italic;\n}\n\n/* Tagesplan-Tabelle */\n.day-schedule {\n    margin-top: 3rem;\n    background: var(--white);\n    padding: 2rem;\n    border-radius: 20px;\n    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);\n    border: 1px solid rgba(127, 176, 105, 0.1);\n}\n\n.day-schedule h3 {\n    color: var(--green);\n    font-size: 1.8rem;\n    margin-bottom: 1.5rem;\n    padding-bottom: 1rem;\n    border-bottom: 3px solid var(--green);\n}\n\n.schedule-table {\n    width: 100%;\n    border-collapse: separate;\n    border-spacing: 0;\n    margin-top: 1rem;\n    overflow: hidden;\n    border-radius: 12px;\n}\n\n.schedule-table th,\n.schedule-table td {\n    border: 1px solid #E0E0E0;\n    padding: 1.2rem;\n    text-align: left;\n}\n\n.schedule-table th {\n    background: linear-gradient(135deg, #2C3E50 0%, #34495E 100%);\n    color: var(--white);\n    font-weight: 700;\n    font-size: 1rem;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n.schedule-table tbody tr {\n    transition: all 0.3s;\n}\n\n.schedule-table tbody tr:nth-child(even) {\n    background-color: #FAFBFC;\n}\n\n.schedule-table tbody tr:hover {\n    background-color: rgba(93, 173, 226, 0.08);\n    transform: scale(1.01);\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);\n}\n\n.schedule-table td:first-child {\n    font-weight: 800;\n    font-size: 1.3rem;\n    color: var(--blue-dark);\n}\n\n.capacity {\n    font-weight: 700;\n    font-size: 1.05rem;\n    color: var(--green);\n    padding: 0.4rem 0.8rem;\n    background: rgba(127, 176, 105, 0.1);\n    border-radius: 6px;\n    display: inline-block;\n}\n\n.capacity.full {\n    color: #E74C3C;\n    background: rgba(231, 76, 60, 0.1);\n    text-decoration: line-through;\n}\n\n/* Buchungsformular */\n.booking-form {\n    max-width: 800px;\n    background-color: var(--white);\n    padding: 2rem;\n    border-radius: 12px;\n    box-shadow: 0 2px 8px var(--shadow);\n}\n\n.booking-info {\n    background: linear-gradient(135deg, var(--sand-light) 0%, #FFF8E7 100%);\n    border: 2px solid var(--sand);\n    border-radius: 8px;\n    padding: 1.5rem;\n    margin-bottom: 2rem;\n}\n\n.booking-info p {\n    margin-bottom: 0.7rem;\n    font-size: 1.05rem;\n}\n\n.teacher-info-section {\n    background-color: var(--light-gray);\n    padding: 1.5rem;\n    border-radius: 8px;\n    margin-bottom: 1.5rem;\n    border-left: 5px solid var(--blue-sky);\n}\n\n.student-entry {\n    border: 2px solid var(--light-gray);\n    padding: 1.2rem;\n    margin-bottom: 1rem;\n    background-color: #FAFAFA;\n    border-radius: 8px;\n    border-left: 4px solid var(--orange);\n}\n\n.form-actions {\n    margin-top: 2rem;\n    padding-top: 1.5rem;\n    border-top: 2px solid var(--light-gray);\n    display: flex;\n    gap: 1rem;\n    flex-wrap: wrap;\n}\n\n/* Admin-Bereich */\n.admin-panel {\n    max-width: 1200px;\n}\n\n.admin-quick-links {\n    display: flex;\n    gap: 1rem;\n    margin-bottom: 2rem;\n    flex-wrap: wrap;\n}\n\n.btn-accent {\n    background: linear-gradient(135deg, var(--green) 0%, #7FB069 100%);\n    color: var(--white);\n    padding: 1rem 1.5rem;\n    border-radius: 10px;\n    font-weight: 600;\n    font-size: 1rem;\n    transition: all 0.3s ease;\n    box-shadow: 0 4px 12px rgba(127, 176, 105, 0.3);\n}\n\n.btn-accent:hover {\n    background: linear-gradient(135deg, #7FB069 0%, var(--green) 100%);\n    transform: translateY(-3px);\n    box-shadow: 0 6px 18px rgba(127, 176, 105, 0.4);\n}\n\n.btn-accent span {\n    margin-right: 0.5rem;\n    font-size: 1.2rem;\n}\n\n.admin-section {\n    margin-bottom: 3rem;\n    padding: 2rem;\n    background-color: var(--white);\n    border-radius: 12px;\n    box-shadow: 0 2px 8px var(--shadow);\n}\n\n.admin-form {\n    max-width: 600px;\n    background-color: var(--light-gray);\n    padding: 1.5rem;\n    border-radius: 8px;\n}\n\n.admin-table {\n    width: 100%;\n    border-collapse: collapse;\n    margin-top: 1rem;\n}\n\n.admin-table th,\n.admin-table td {\n    border: 2px solid var(--light-gray);\n    padding: 1rem;\n    text-align: left;\n}\n\n.admin-table th {\n    background: linear-gradient(135deg, var(--dark) 0%, var(--gray) 100%);\n    color: var(--white);\n}\n\n.admin-table tr:nth-child(even) {\n    background-color: var(--light-gray);\n}\n\n.role-badge {\n    display: inline-block;\n    padding: 0.3rem 0.8rem;\n    border-radius: 20px;\n    font-weight: 600;\n    font-size: 0.85rem;\n}\n\n.role-badge.admin {\n    background-color: var(--orange);\n    color: var(--white);\n}\n\n.role-badge.teacher {\n    background-color: var(--blue-sky);\n    color: var(--white);\n}\n\n.filter-form {\n    margin-bottom: 1.5rem;\n    padding: 1.2rem;\n    background-color: var(--light-gray);\n    border-radius: 8px;\n}\n\n.filter-form label {\n    font-weight: 600;\n    margin-right: 0.5rem;\n}\n\n.filter-form input {\n    padding: 0.6rem;\n    border: 2px solid var(--blue-sky);\n    border-radius: 8px;\n    margin-right: 0.5rem;\n}\n\n.bookings-table .student-list {\n    margin-top: 0.5rem;\n    padding-left: 1.5rem;\n    list-style-type: disc;\n}\n\n.no-data {\n    text-align: center;\n    font-style: italic;\n    color: var(--gray);\n}\n\n/* Vergangene Termine Styles */\n.period-past {\n    opacity: 0.5;\n    background: linear-gradient(135deg, #D5D5D5 0%, #E8E8E8 100%) !important;\n    border-left: 5px solid #999 !important;\n    cursor: not-allowed;\n}\n\n.period-past .period-header {\n    background: linear-gradient(135deg, #C0C0C0 0%, #D5D5D5 100%) !important;\n    color: #666 !important;\n    border: 2px solid #999 !important;\n}\n\n.period-past:hover {\n    transform: none !important;\n    box-shadow: none !important;\n}\n\n.past-row {\n    background-color: #F5F5F5 !important;\n    opacity: 0.6;\n}\n\n.past-row:hover {\n    background-color: #F0F0F0 !important;\n    transform: none !important;\n}\n\n.past-text {\n    color: #999 !important;\n    font-style: italic;\n    text-decoration: line-through;\n}\n\n/* Footer */\nfooter {\n    background: linear-gradient(135deg, var(--dark) 0%, var(--gray) 100%);\n    color: var(--white);\n    padding: 1.5rem 0;\n    margin-top: 3rem;\n    text-align: center;\n}\n\n/* Responsive Design */\n@media (max-width: 768px) {\n    body {\n        font-size: 14px;\n    }\n    \n    .container {\n        padding: 0 10px;\n    }\n    \n    main {\n        padding: 1rem 0;\n    }\n    \n    /* Navigation */\n    .top-nav {\n        padding: 0.8rem 0;\n    }\n    \n    .top-nav nav {\n        flex-direction: column;\n        gap: 0.5rem;\n    }\n    \n    .top-nav nav a {\n        text-align: center;\n        padding: 0.8rem;\n        font-size: 0.95rem;\n    }\n    \n    /* Login */\n    .login-container {\n        padding: 2rem 10px;\n    }\n    \n    .login-box {\n        padding: 2rem 1.5rem;\n    }\n    \n    .login-logo img {\n        width: 100px;\n        height: 100px;\n    }\n    \n    .login-box h2 {\n        font-size: 1.6rem;\n    }\n    \n    /* Dashboard */\n    h2 {\n        font-size: 1.5rem;\n    }\n    \n    h3 {\n        font-size: 1.3rem;\n    }\n    \n    .date-selector {\n        flex-direction: column;\n        padding: 1rem;\n        align-items: stretch;\n    }\n    \n    .date-selector label {\n        font-size: 1rem;\n    }\n    \n    .date-selector input {\n        width: 100%;\n        font-size: 1rem;\n        padding: 0.8rem;\n    }\n    \n    .selected-date-info h3 {\n        font-size: 1.4rem;\n        padding: 1rem;\n    }\n    \n    /* Wochenübersicht - Horizontal scrollbar für mobile */\n    .week-overview {\n        padding: 1rem;\n        margin-bottom: 2rem;\n        overflow-x: auto;\n        -webkit-overflow-scrolling: touch;\n    }\n    \n    .week-overview h3 {\n        font-size: 1.4rem;\n        margin-bottom: 1rem;\n    }\n    \n    .week-table {\n        min-width: 600px;\n        font-size: 0.75rem;\n    }\n    \n    .week-table th,\n    .week-table td {\n        padding: 0.6rem 0.4rem;\n    }\n    \n    .day-name {\n        font-size: 0.9rem;\n        letter-spacing: 0.5px;\n    }\n    \n    .day-date {\n        font-size: 0.75rem;\n    }\n    \n    .period-header {\n        padding: 0.4rem 0.5rem;\n        font-size: 0.75rem;\n        margin-bottom: 0.5rem;\n    }\n    \n    .booking-info {\n        padding: 0.5rem;\n        font-size: 0.7rem;\n        margin-top: 0.5rem;\n    }\n    \n    .booking-info strong {\n        font-size: 0.75rem;\n    }\n    \n    /* Tagesplan - Auch mit Scroll */\n    .day-schedule {\n        padding: 1rem;\n        margin-top: 2rem;\n        overflow-x: auto;\n        -webkit-overflow-scrolling: touch;\n    }\n    \n    .day-schedule h3 {\n        font-size: 1.4rem;\n        margin-bottom: 1rem;\n        white-space: normal;\n        word-break: break-word;\n    }\n    \n    .schedule-table {\n        min-width: 100%;\n        font-size: 0.85rem;\n    }\n    \n    .schedule-table th,\n    .schedule-table td {\n        padding: 0.8rem 0.5rem;\n    }\n    \n    .schedule-table th {\n        font-size: 0.85rem;\n    }\n    \n    .schedule-table td:first-child {\n        font-size: 1.1rem;\n    }\n    \n    .capacity {\n        font-size: 0.9rem;\n        padding: 0.3rem 0.6rem;\n    }\n    \n    /* Buttons mobile-optimiert */\n    .btn {\n        padding: 0.7rem 1.2rem;\n        font-size: 0.95rem;\n        width: 100%;\n        text-align: center;\n        display: block;\n        margin-bottom: 0.5rem;\n    }\n    \n    .btn:hover {\n        transform: none;\n    }\n    \n    /* Admin */\n    .admin-panel {\n        padding: 0;\n    }\n    \n    .admin-section {\n        padding: 1rem;\n        margin-bottom: 1.5rem;\n    }\n    \n    .admin-table {\n        font-size: 0.8rem;\n        overflow-x: auto;\n        display: block;\n    }\n    \n    .admin-table th,\n    .admin-table td {\n        padding: 0.6rem 0.4rem;\n    }\n    \n    /* Forms */\n    .form-actions {\n        flex-direction: column;\n    }\n    \n    .form-group input,\n    .form-group select {\n        font-size: 16px; /* Verhindert Zoom auf iOS */\n    }\n    \n    /* Message anpassen */\n    .message {\n        padding: 0.8rem 1rem;\n        font-size: 0.9rem;\n    }\n    \n    /* Scroll-Hinweis für Tabellen */\n    .week-overview::after,\n    .day-schedule::after {\n        content: \"← Wischen für mehr →\";\n        display: block;\n        text-align: center;\n        font-size: 0.75rem;\n        color: var(--gray);\n        margin-top: 0.5rem;\n        font-style: italic;\n    }\n}\n\n/* Extra kleine Geräte */\n@media (max-width: 480px) {\n    .selected-date-info h3 {\n        font-size: 1.2rem;\n        padding: 0.8rem;\n    }\n    \n    .week-table {\n        font-size: 0.7rem;\n    }\n    \n    .day-name {\n        font-size: 0.8rem;\n    }\n    \n    .day-date {\n        font-size: 0.65rem;\n    }\n    \n    .schedule-table {\n        font-size: 0.8rem;\n    }\n    \n    .login-box {\n        padding: 1.5rem 1rem;\n    }\n}\n\n/* Credits Button */\n.credits-button {\n    position: fixed;\n    bottom: 20px;\n    right: 20px;\n    width: 50px;\n    height: 50px;\n    border-radius: 50%;\n    background: linear-gradient(135deg, var(--blue-sky) 0%, var(--blue-dark) 100%);\n    color: var(--white);\n    font-size: 24px;\n    font-weight: bold;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n    transition: all 0.3s ease;\n    z-index: 1000;\n}\n\n.credits-button:hover {\n    transform: scale(1.1);\n    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);\n}\n\n/* Credits Modal */\n.credits-modal {\n    display: none;\n    position: fixed;\n    z-index: 1001;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0, 0, 0, 0.5);\n    backdrop-filter: blur(4px);\n}\n\n.credits-content {\n    background-color: var(--white);\n    margin: 15% auto;\n    padding: 2rem;\n    border: none;\n    border-radius: 12px;\n    width: 90%;\n    max-width: 400px;\n    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);\n    animation: slideIn 0.3s ease;\n}\n\n@keyframes slideIn {\n    from {\n        transform: translateY(-50px);\n        opacity: 0;\n    }\n    to {\n        transform: translateY(0);\n        opacity: 1;\n    }\n}\n\n.credits-content h3 {\n    color: var(--blue-dark);\n    margin-bottom: 1.5rem;\n    font-size: 1.5rem;\n    text-align: center;\n}\n\n.credits-content p {\n    margin-bottom: 1rem;\n    line-height: 1.8;\n    color: var(--dark);\n}\n\n.credits-content p strong {\n    color: var(--blue-dark);\n}\n\n.credits-close {\n    color: var(--gray);\n    float: right;\n    font-size: 32px;\n    font-weight: bold;\n    cursor: pointer;\n    transition: color 0.3s;\n    line-height: 1;\n    margin-top: -10px;\n}\n\n.credits-close:hover,\n.credits-close:focus {\n    color: var(--dark);\n}\n\n/* Responsive Credits Modal */\n@media (max-width: 768px) {\n    .credits-content {\n        margin: 30% auto;\n        padding: 1.5rem;\n    }\n    \n    .credits-button {\n        width: 45px;\n        height: 45px;\n        font-size: 20px;\n        bottom: 15px;\n        right: 15px;\n    }\n}\n\n/* Blockierte Slots */\n.period-blocked {\n    background: linear-gradient(135deg, #FF6B6B 0%, #C92A2A 100%) !important;\n    color: var(--white) !important;\n    border: 2px solid #C92A2A !important;\n}\n\n.period-blocked .period-header,\n.period-blocked .booking-info,\n.period-blocked .admin-actions {\n    color: var(--white);\n}\n\n.blocked-header {\n    font-weight: 700;\n    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);\n}\n\n.blocked-row {\n    background-color: rgba(255, 107, 107, 0.1);\n}\n\n.blocked-text {\n    color: #C92A2A;\n    font-weight: 700;\n}\n\n.admin-actions {\n    margin-top: 0.8rem;\n    padding-top: 0.8rem;\n    border-top: 1px solid rgba(255, 255, 255, 0.3);\n}\n\n.btn-small {\n    padding: 0.4rem 0.8rem;\n    font-size: 0.85rem;\n    border-radius: 6px;\n    border: none;\n    cursor: pointer;\n    font-weight: 600;\n    transition: all 0.3s;\n}\n\n.btn-success {\n    background: linear-gradient(135deg, var(--green) 0%, #5A9349 100%);\n    color: var(--white);\n}\n\n.btn-success:hover {\n    background: linear-gradient(135deg, #5A9349 0%, var(--green) 100%);\n    transform: translateY(-2px);\n    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);\n}\n\n.btn-block {\n    background: linear-gradient(135deg, #FF9500 0%, #E07B00 100%);\n    color: var(--white);\n}\n\n.btn-block:hover {\n    background: linear-gradient(135deg, #E07B00 0%, #FF9500 100%);\n    transform: translateY(-2px);\n    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);\n}\n\n.btn-warning {\n    background: linear-gradient(135deg, #FFA500 0%, #FF8C00 100%);\n    color: var(--white);\n    border: none;\n}\n\n/* Modernes Buchungsformular Design */\n.booking-container {\n    max-width: 900px;\n    margin: 0 auto;\n    padding: 2rem 1rem;\n}\n\n.booking-header-card {\n    background: linear-gradient(135deg, var(--blue-sky) 0%, var(--blue-dark) 100%);\n    color: var(--white);\n    padding: 2rem;\n    border-radius: 20px;\n    text-align: center;\n    margin-bottom: 2rem;\n    box-shadow: 0 10px 30px rgba(93, 173, 226, 0.3);\n}\n\n.booking-header-card h2 {\n    color: var(--white);\n    font-size: 2.5rem;\n    margin-bottom: 0.5rem;\n    border-bottom: none;\n}\n\n.booking-subtitle {\n    font-size: 1.1rem;\n    opacity: 0.95;\n    margin: 0;\n}\n\n.booking-info-card {\n    background: var(--white);\n    border-radius: 16px;\n    padding: 2rem;\n    margin-bottom: 2rem;\n    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);\n    border: 2px solid rgba(93, 173, 226, 0.2);\n}\n\n.info-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n    gap: 1.5rem;\n}\n\n.info-item {\n    display: flex;\n    align-items: center;\n    gap: 1rem;\n    padding: 1rem;\n    background: linear-gradient(135deg, rgba(93, 173, 226, 0.05) 0%, rgba(127, 176, 105, 0.05) 100%);\n    border-radius: 12px;\n    border: 1px solid rgba(93, 173, 226, 0.15);\n}\n\n.info-icon {\n    font-size: 2rem;\n    flex-shrink: 0;\n}\n\n.info-content {\n    display: flex;\n    flex-direction: column;\n    gap: 0.3rem;\n}\n\n.info-label {\n    font-size: 0.85rem;\n    color: var(--gray);\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n.info-value {\n    font-size: 1.1rem;\n    color: var(--dark);\n    font-weight: 700;\n}\n\n.capacity-indicator {\n    color: var(--green);\n}\n\n.badge {\n    display: inline-block;\n    padding: 0.4rem 0.8rem;\n    border-radius: 20px;\n    font-size: 0.9rem;\n    font-weight: 600;\n}\n\n.badge-fest {\n    background: linear-gradient(135deg, var(--sand) 0%, var(--sand-light) 100%);\n    color: var(--dark);\n}\n\n.badge-frei {\n    background: linear-gradient(135deg, var(--green) 0%, #A8D5BA 100%);\n    color: var(--white);\n}\n\n.booking-form-modern {\n    display: flex;\n    flex-direction: column;\n    gap: 1.5rem;\n}\n\n.form-card {\n    background: var(--white);\n    border-radius: 16px;\n    padding: 0;\n    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);\n    border: 2px solid rgba(93, 173, 226, 0.1);\n    overflow: hidden;\n    transition: all 0.3s;\n}\n\n.form-card:hover {\n    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);\n    transform: translateY(-2px);\n}\n\n.card-header {\n    background: linear-gradient(135deg, var(--blue-sky) 0%, var(--blue-dark) 100%);\n    color: var(--white);\n    padding: 1.2rem 1.5rem;\n    display: flex;\n    align-items: center;\n    gap: 1rem;\n}\n\n.card-icon {\n    font-size: 1.8rem;\n}\n\n.card-header h3 {\n    margin: 0;\n    font-size: 1.4rem;\n    color: var(--white);\n}\n\n.card-body {\n    padding: 1.5rem;\n}\n\n.form-row {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n    gap: 1rem;\n}\n\n.student-fields-container {\n    margin-top: 1.5rem;\n    display: flex;\n    flex-direction: column;\n    gap: 1rem;\n}\n\n.student-entry-modern {\n    background: linear-gradient(135deg, rgba(232, 184, 109, 0.08) 0%, rgba(245, 230, 211, 0.08) 100%);\n    border: 2px solid var(--sand);\n    border-radius: 12px;\n    padding: 1.2rem;\n    transition: all 0.3s;\n}\n\n.student-entry-modern:hover {\n    transform: translateX(5px);\n    box-shadow: 0 4px 12px rgba(232, 184, 109, 0.2);\n}\n\n.student-number {\n    font-weight: 700;\n    font-size: 1.1rem;\n    color: var(--orange);\n    margin-bottom: 1rem;\n    padding-bottom: 0.5rem;\n    border-bottom: 2px solid var(--sand-light);\n}\n\n.form-actions-modern {\n    display: flex;\n    justify-content: space-between;\n    gap: 1rem;\n    margin-top: 1rem;\n}\n\n.btn-large {\n    padding: 1.2rem 2rem;\n    font-size: 1.2rem;\n    font-weight: 700;\n    border-radius: 12px;\n}\n\n.btn-large span,\n.btn-secondary span {\n    margin-right: 0.5rem;\n}\n\n.btn-warning:hover {\n    background: linear-gradient(135deg, #FF8C00 0%, #FFA500 100%);\n    transform: translateY(-2px);\n    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);\n}\n","size_bytes":29457},"replit.md":{"content":"# SportOase Buchungssystem\n\n## Overview\n\nSportOase Buchungssystem is a web-based booking management system for a school sports facility. The application enables teachers to book time slots for students (1-5 per slot) and provides administrators with management capabilities for teachers and bookings. The system includes a weekly schedule with fixed and flexible offerings, capacity controls, and email notifications for new bookings.\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### Frontend Architecture\n\n**Template Engine**: Jinja2 (Flask templates)\n- Base template pattern for consistent layout across all pages\n- Simple HTML/CSS design with black-and-white color scheme\n- Responsive layout suitable for desktop and tablet devices\n- Key templates: login, dashboard (with weekly overview), booking form, admin panel\n\n**Static Assets**:\n- Minimal CSS in `/static/style.css` for clean, professional styling\n- No JavaScript frameworks - vanilla JS for dynamic form interactions (e.g., student field generation)\n\n### Backend Architecture\n\n**Web Framework**: Flask (Python 3.11)\n- Session-based authentication using Flask sessions\n- Decorator-based route protection (`@login_required`, `@admin_required`)\n- Timezone-aware datetime handling using `pytz` (Europe/Berlin)\n\n**Application Structure**:\n- `app.py`: Main application file containing all route handlers\n- `config.py`: Configuration settings for class periods, fixed/free offerings, and module options\n- `models.py`: Database interaction layer with SQLite\n- `email_service.py`: SMTP-based email notification service\n- `db_setup.py`: Database initialization script\n\n**Key Features**:\n- Role-based access control (teacher vs. admin)\n- Booking validation: 60-minute advance booking requirement, 5-student maximum capacity per slot\n- Past date detection: Slots in the past are visually greyed out and cannot be booked\n- Weekly schedule display with fixed vs. flexible time slots with booking information (who booked, how many students)\n- Dynamic module selection for flexible time slots\n- Admin booking management: create, edit, and delete bookings with full validation\n- Capacity-aware editing that prevents overbooking\n- Modern card-based booking form design with improved visual hierarchy\n\n### Data Storage\n\n**Database**: PostgreSQL (Neon-backed via Replit)\n\n**ORM**: Flask-SQLAlchemy 3.1.1\n\n**Architecture**:\n- `database.py`: Central SQLAlchemy instance shared across the application\n- `models.py`: ORM model definitions (User, Booking, SlotName) and helper functions\n- `db_setup.py`: Explicit database initialization and admin account creation\n\n**Schema Design**:\n- `users` table: Stores user credentials and roles (teacher/admin)\n  - Password hashing using `werkzeug.security`\n  - Username-based authentication (switched from email)\n  - Role column for access control\n  - Email field for notifications\n\n- `bookings` table: Stores all booking records\n  - Date and period (1-6) tracking\n  - Student information stored as JSON in `students_json` column\n  - Offer type classification (fest/frei)\n  - Foreign key relationship to users table\n  - Created timestamp for audit trail\n\n- `slot_names` table: Stores customizable names for fixed slots\n  - Weekday and period as unique key\n  - Label field for custom slot names\n  - Allows admins to rename fixed slots without changing config.py\n  - Falls back to default names from FIXED_OFFERS if no custom name exists\n\n- `blocked_slots` table: Stores temporarily blocked time slots for admin use\n  - Date and period as unique key\n  - Reason field for blocking purpose (e.g., \"Beratung\")\n  - Foreign key to users table (which admin blocked it)\n  - Prevents regular users from booking blocked periods\n  - Admins can block/unblock slots via dashboard UI\n\n**Data Model Rationale**: \n- PostgreSQL chosen for production deployment compatibility (Render)\n- SQLAlchemy ORM provides type safety and easier migrations\n- JSON storage for student data provides flexibility for variable numbers of students per booking\n- Centralized database instance prevents initialization conflicts\n- SlotName table enables dynamic slot renaming without code changes\n\n### Authentication & Authorization\n\n**Authentication Mechanism**: Session-based authentication\n- Flask server-side sessions with secret key\n- Hashed passwords (werkzeug's generate_password_hash/check_password_hash)\n- Login credentials: email + password\n\n**Authorization Levels**:\n- Teachers: Can create bookings, view dashboard\n- Admins: Full teacher permissions plus user management and booking overview\n\n**Session Management**:\n- User ID, email, and role stored in session\n- Decorator functions enforce authentication and authorization requirements\n- Logout clears session data\n\n### External Dependencies\n\n**SMTP Email Service**:\n- Environment variables for configuration: `SMTP_HOST`, `SMTP_PORT`, `SMTP_USER`, `SMTP_PASS`, `SMTP_FROM`, `ADMIN_EMAIL`\n- Admin email: sportoase.kg@gmail.com (receives all booking notifications)\n- Graceful degradation: prints notifications to console when SMTP not configured\n- Purpose: Automated booking notifications to administrators and teachers\n\n**Python Packages**:\n- Flask 3.1.2: Web framework\n- Flask-SQLAlchemy 3.1.1: ORM for PostgreSQL\n- psycopg2-binary 2.9.11: PostgreSQL adapter\n- gunicorn 23.0.0: Production WSGI server\n- pytz 2025.2: Timezone handling (Europe/Berlin)\n- werkzeug 3.1.3: Password hashing utilities\n- email-validator 2.3.0: Email validation\n- smtplib & email.mime: Email functionality (standard library)\n\n**Configuration**:\n- Period times, fixed offerings, and free modules defined in `config.py`\n- Environment-based SMTP configuration for deployment flexibility\n- Default admin credentials created during database initialization\n\n### Deployment\n\n**Platform**: Render (https://render.com)\n\n**Database**: PostgreSQL on Render (free tier, 90-day expiration)\n\n**Key Files**:\n- `requirements.txt`: Python dependencies for deployment\n- `DEPLOYMENT.md`: Complete deployment guide for Render\n- `db_setup.py`: Database initialization script (MUST be run after first deploy)\n\n**Environment Variables Required**:\n- `DATABASE_URL`: PostgreSQL connection string (from Render)\n- `SESSION_SECRET`: Random secret for Flask sessions\n- `ADMIN_EMAIL`: sportoase.kg@gmail.com (for booking notifications)\n- Optional SMTP settings for email notifications\n\n**Important Notes**:\n- Schema is NOT created automatically - run `python db_setup.py` after deployment\n- Default admin account: username `sportoase`, password `mauro123`, email `sportoase.kg@gmail.com`\n- Change admin password after first login!\n\n## Recent Changes\n\n- 2024-11-15: **Past Date Detection & Modernized Booking Design**\n  - **Past Date Protection**: Implemented comprehensive past date detection and prevention\n    - Created `is_past_date()` helper function using Berlin timezone (Europe/Berlin)\n    - Backend validation prevents bookings of past time slots\n    - Dashboard marks past slots with `is_past` flag in both weekly overview and daily view\n    - Past slots are visually greyed out with distinctive styling (.period-past, .past-row, .past-text)\n    - Server-side enforcement ensures no bookings can be created for past dates\n  - **Modernized Booking Form Design**: Complete redesign of booking interface\n    - Card-based layout with icon-enhanced sections for better visual hierarchy\n    - Separate cards for booking info, teacher details, students, and module selection\n    - Professional gradient backgrounds and shadow effects\n    - Improved form spacing, typography, and color scheme\n    - Responsive design with better mobile support\n    - Visual capacity indicator showing available spots (e.g., \"3 / 5\")\n  - **CSRF Token Fix**: Corrected CSRF token implementation\n    - Context processor now returns token value directly (not function)\n    - All templates updated to use `{{ csrf_token }}` without parentheses\n    - Secure form submissions across all POST requests\n  - **CSS Enhancements**:\n    - Added `.booking-container`, `.booking-info-card`, `.info-grid` styles\n    - Created `.form-card`, `.card-header`, `.card-body` for modern card layout\n    - Improved button styling with hover effects and transitions\n    - Enhanced badge styles for fest/frei offerings\n    - Responsive grid layouts for better form organization\n\n- 2024-11-15: **Admin Slot Blocking for Consultation Meetings**\n  - **Slot Blocking Feature**: Admins can now block time slots for consultation meetings (Beratungsgespräche)\n    - Created `BlockedSlot` database model with date/period unique constraint\n    - Foreign key to users table tracks which admin blocked each slot\n    - Reason field stores blocking purpose (e.g., \"Beratung\")\n    - Admin routes with CSRF protection for secure slot management\n  - **Dashboard UI Enhancements**:\n    - Added \"Blockieren\" buttons for admins on all unblocked slots\n    - Added \"Freigeben\" buttons for admins on blocked slots\n    - Blocked slots displayed in distinctive red styling (.period-blocked class)\n    - Both weekly overview and daily view show blocking controls\n  - **Booking Logic Updates**:\n    - Booking route validates blocked status before displaying form (GET)\n    - POST requests also validate and reject bookings for blocked slots\n    - Flash messages inform users when attempting to book blocked slots\n  - **Security**:\n    - CSRF token validation on all admin block/unblock routes\n    - Invalid tokens rejected with error message and redirect\n    - Admin-only access enforced via @admin_required decorator\n\n- 2024-11-14: **New Interactive Features & UX Improvements**\n  - **Clickable Week Overview Slots**: Users can now click directly on slots in the week overview to access the booking form\n    - Added `can_book` and `available` information to week overview data\n    - Implemented visual affordance with hover effects and booking action indicators\n    - Shows availability status and free slots for each period\n    - CSS styling with gradient backgrounds and hover animations\n  - **Admin Slot Name Management**: Admins can now customize the names of fixed slots\n    - Created new `SlotName` database model for storing custom slot names\n    - Added `/admin/manage_slots` route with management interface\n    - Implemented modal-based editing UI with data attributes for security\n    - Custom names override default FIXED_OFFERS from config.py\n    - Protected against XSS with proper textContent usage\n    - Fixed JavaScript security issue with apostrophes in slot names\n  - **Database Schema Update**:\n    - Added `slot_names` table with weekday/period unique constraint\n    - Integrated custom slot names into `get_period_info()` function\n    - Custom names propagate through dashboard, week overview, and booking forms\n  - **UI/UX Enhancements**:\n    - Added admin quick-links section with accent buttons\n    - Improved CSS with clickable-slot and booking-action styles\n    - Modal interface for slot renaming with live preview\n    - Consistent color scheme using existing design variables\n\n- 2024-11-14: **Major Migration: SQLite → PostgreSQL**\n  - **Database Migration**: Migrated from SQLite to PostgreSQL for production deployment\n    - Created `database.py` with centralized SQLAlchemy instance\n    - Refactored `models.py` to use Flask-SQLAlchemy ORM instead of raw SQL\n    - Converted all database queries from sqlite3 to SQLAlchemy\n    - Removed automatic schema creation from app startup\n    - Made schema creation explicit via `db_setup.py`\n  - **Email Configuration Update**:\n    - Changed admin email from `admin@school.de` to `sportoase.kg@gmail.com`\n    - Updated `config.py` ADMIN_EMAIL default\n    - Modified `db_setup.py` to create admin with correct email\n    - Updated existing admin user in database\n  - **Deployment Preparation**:\n    - Created `requirements.txt` with all dependencies\n    - Created comprehensive `DEPLOYMENT.md` with Render deployment guide\n    - Configured PostgreSQL connection with environment variables\n    - Added production-ready gunicorn configuration\n  - **Architecture Improvements**:\n    - Single SQLAlchemy instance shared across application\n    - Clean separation of database initialization from web app\n    - Production-safe schema management\n\n\n- 2024-11-14: Enhanced admin panel and week overview features\n  - **Admin Booking Management**: Added full CRUD operations for bookings (create, edit, delete)\n    - Admins can now create bookings on behalf of any teacher\n    - Admins can edit existing bookings with all validations\n    - Added capacity checks to prevent overbooking in admin workflows\n    - Implemented safe error handling for all user inputs\n  - **Week Plan Overview Enhancements**: \n    - Added booking information to weekly overview showing who booked each slot\n    - Display teacher names and student counts for each booking\n    - Week overview now shows total students per period\n  - **Data Safety Improvements**:\n    - Guarded all JSON parsing against invalid/missing data\n    - Added proper exception handling for form input validation\n    - Fixed sqlite3.Row object handling throughout the application\n  - Created `admin_edit_booking.html` template for admin booking form\n  - Added database functions: `get_booking_by_id`, `update_booking`, `get_bookings_for_week`\n\n- 2024-11-14: Initial implementation of complete SportOase booking system\n  - Created all core files (app.py, config.py, models.py, db_setup.py, email_service.py)\n  - Implemented authentication system with role-based access control\n  - Built dashboard with weekly schedule overview and booking availability display\n  - Created booking form with capacity validation and 60-minute advance requirement\n  - Developed admin panel for teacher management and booking overview\n  - Designed black-and-white responsive UI with all templates\n  - Configured workflow to run Flask app on port 5000\n  - Initialized database with default admin account (admin@sportoase.de / admin123)\n","size_bytes":13964},"db_setup.py":{"content":"# Skript zur Initialisierung der PostgreSQL-Datenbank\n# Dieses Skript erstellt die Datenbank und legt einen Admin-Benutzer an\n\nimport os\nfrom app import app\nfrom models import create_user, get_user_by_username\nfrom database import db\n\ndef setup_database():\n    \"\"\"Initialisiert die Datenbank und erstellt einen Standard-Admin-Account\"\"\"\n    with app.app_context():\n        print(\"Erstelle Datenbank-Tabellen...\")\n        db.create_all()\n        print(\"Datenbank-Tabellen erfolgreich erstellt!\")\n        \n        # Prüfe, ob bereits ein Admin existiert\n        admin = get_user_by_username('sportoase')\n        if not admin:\n            # Erstelle Standard-Admin mit korrekter E-Mail\n            admin_id = create_user('sportoase', 'mauro123', 'admin', 'sportoase.kg@gmail.com')\n            if admin_id:\n                print(f\"\\nAdmin-Account erstellt:\")\n                print(f\"  Benutzername: sportoase\")\n                print(f\"  Passwort: mauro123\")\n                print(f\"  E-Mail: sportoase.kg@gmail.com\")\n            else:\n                print(\"\\nFehler: Admin-Account konnte nicht erstellt werden.\")\n        else:\n            print(\"\\nAdmin-Account existiert bereits.\")\n        \n        print(\"\\nDatenbank-Setup abgeschlossen!\")\n        print(\"Sie können sich jetzt mit den Admin-Zugangsdaten anmelden.\")\n\nif __name__ == '__main__':\n    setup_database()\n","size_bytes":1366},"config.py":{"content":"# Konfigurationsdatei für die SportOase-Anwendung\n# Diese Datei enthält alle wichtigen Einstellungen wie Stundenpläne und Zeitangaben\n\nimport os\n\n# Zeitplan der Schulstunden (Beginn und Ende jeder Stunde)\n# Format: \"HH:MM\" für Start und Ende\nPERIOD_TIMES = {\n    1: {\"start\": \"07:50\", \"end\": \"08:35\"},\n    2: {\"start\": \"08:35\", \"end\": \"09:20\"},\n    3: {\"start\": \"09:40\", \"end\": \"10:25\"},\n    4: {\"start\": \"10:25\", \"end\": \"11:20\"},\n    5: {\"start\": \"11:40\", \"end\": \"12:25\"},\n    6: {\"start\": \"12:25\", \"end\": \"13:10\"}\n}\n\n# Feste Angebote pro Wochentag und Stunde\n# \"Mon\" = Montag, \"Tue\" = Dienstag, etc.\n# Wenn eine Stunde hier nicht aufgeführt ist, ist sie FREI (Lehrkraft wählt Modul)\nFIXED_OFFERS = {\n    \"Mon\": {  # Montag\n        1: \"Wochenstart-Aktivierung\",\n        3: \"Konflikt-Reset & Deeskalation\",\n        5: \"Koordinationszirkel\"\n    },\n    \"Tue\": {  # Dienstag - alle Stunden frei\n    },\n    \"Wed\": {  # Mittwoch\n        1: \"Sozialtraining / Gruppenreset\",\n        3: \"Aktivierung Mini-Fitness\",\n        5: \"Motorik-Parcours\"\n    },\n    \"Thu\": {  # Donnerstag\n        2: \"Konflikt-Reset\",\n        5: \"Turnen + Balance\"\n    },\n    \"Fri\": {  # Freitag\n        2: \"Atem & Reflexion\",\n        4: \"Bodyscan Light\",\n        5: \"Ruhezone / Entspannung\"\n    }\n}\n\n# Module, die bei freien Stunden wählbar sind\nFREE_MODULES = [\n    \"Aktivierung\",\n    \"Regulation / Entspannung\",\n    \"Konflikt-Reset\",\n    \"Egal / flexibel\"\n]\n\n# Maximale Anzahl Schüler pro Stunde\nMAX_STUDENTS_PER_PERIOD = 5\n\n# Vorlaufzeit für Buchungen in Minuten\nBOOKING_ADVANCE_MINUTES = 60\n\n# SMTP-Konfiguration (aus Umgebungsvariablen)\nSMTP_HOST = os.environ.get('SMTP_HOST', 'smtp.gmail.com')\nSMTP_PORT = int(os.environ.get('SMTP_PORT', '587'))\nSMTP_USER = os.environ.get('SMTP_USER', 'sportoase.kgs@gmail.com')\nSMTP_PASS = os.environ.get('SMTP_PASS', 'Unhack85!$')\nSMTP_FROM = os.environ.get('SMTP_FROM', 'sportoase@school.de')\nADMIN_EMAIL = os.environ.get('ADMIN_EMAIL', 'sportoase.kg@gmail.com')\n\n# Flask Session Secret (aus Umgebungsvariable)\nSECRET_KEY = os.environ.get('SESSION_SECRET', 'dev-secret-key-change-in-production')\n\n# Datenbank-Konfiguration (PostgreSQL)\nDATABASE_URL = os.environ.get('DATABASE_URL', 'postgresql://localhost/sportoase')\n","size_bytes":2236},"main.py":{"content":"def main():\n    print(\"Hello from repl-nix-workspace!\")\n\n\nif __name__ == \"__main__\":\n    main()\n","size_bytes":96},"database.py":{"content":"# Zentrale Datenbank-Konfiguration\n# Diese Datei stellt die gemeinsame SQLAlchemy-Instanz bereit\n\nfrom flask_sqlalchemy import SQLAlchemy\n\ndb = SQLAlchemy()\n","size_bytes":157},"DEPLOYMENT.md":{"content":"# Deployment Guide für Render\n\nDiese Anleitung beschreibt, wie Sie die SportOase-App auf Render deployen.\n\n## Voraussetzungen\n\n- GitHub Repository mit dem Code\n- Render Account (kostenlos verfügbar)\n\n## Schritt 1: PostgreSQL-Datenbank erstellen\n\n1. Gehen Sie zu [Render Dashboard](https://dashboard.render.com/)\n2. Klicken Sie auf **New +** → **PostgreSQL**\n3. Konfiguration:\n   - **Name**: `sportoase-db` (oder ein anderer Name)\n   - **Database**: Leer lassen (wird automatisch generiert)\n   - **User**: Leer lassen (wird automatisch generiert)\n   - **Region**: Wählen Sie die nächstgelegene Region\n   - **PostgreSQL Version**: 15 oder 16\n   - **Plan**: Free (läuft nach 90 Tagen ab, erfordert Backup/Neuaufbau)\n\n4. Klicken Sie auf **Create Database**\n5. Notieren Sie sich die **Internal Database URL** (wird später benötigt)\n6. **WICHTIG**: Ändern Sie `postgres://` zu `postgresql://` in der URL\n\n## Schritt 2: Web Service erstellen\n\n1. Klicken Sie auf **New +** → **Web Service**\n2. Verbinden Sie Ihr GitHub Repository\n3. Konfiguration:\n\n| Einstellung | Wert |\n|-------------|------|\n| **Name** | `sportoase-app` |\n| **Region** | Gleiche wie Datenbank |\n| **Branch** | `main` |\n| **Build Command** | `pip install -r requirements.txt` |\n| **Start Command** | `gunicorn app:app` |\n| **Plan** | Free |\n\n## Schritt 3: Umgebungsvariablen konfigurieren\n\nFügen Sie diese Umgebungsvariablen hinzu (unter **Environment**):\n\n| Variable | Wert | Beschreibung |\n|----------|------|--------------|\n| `DATABASE_URL` | Internal Database URL von PostgreSQL | **Wichtig**: `postgres://` zu `postgresql://` ändern! |\n| `SESSION_SECRET` | Ein zufälliger String | Für Flask Sessions (z.B. 32+ Zeichen) |\n| `PYTHON_VERSION` | `3.11` | Python-Version |\n| `SMTP_HOST` | SMTP-Server | Optional: Für E-Mail-Benachrichtigungen |\n| `SMTP_PORT` | `587` | Optional: SMTP Port |\n| `SMTP_USER` | Ihr SMTP Benutzername | Optional |\n| `SMTP_PASS` | Ihr SMTP Passwort | Optional |\n| `SMTP_FROM` | sportoase@sportoase.de | Optional: Absender-E-Mail |\n| `ADMIN_EMAIL` | sportoase.kg@gmail.com | Admin E-Mail für Benachrichtigungen |\n\n### Beispiel für SESSION_SECRET generieren:\n\n```python\nimport os\nprint(os.urandom(32).hex())\n```\n\n## Schritt 4: Datenbank initialisieren\n\n**WICHTIG**: Nach dem ersten Deployment MUSS die Datenbank initialisiert werden!\n\n1. Verbinden Sie sich mit der Render Shell (im Dashboard unter \"Shell\")\n2. Führen Sie aus:\n\n```bash\npython db_setup.py\n```\n\nDies erstellt:\n- Alle Datenbank-Tabellen\n- Den Admin-Account mit:\n  - **Benutzername**: sportoase\n  - **Passwort**: mauro123\n  - **E-Mail**: sportoase.kg@gmail.com\n\n**WICHTIG**: Ändern Sie das Passwort nach dem ersten Login!\n\n## Schritt 5: Deployment überprüfen\n\n1. Öffnen Sie die URL Ihrer App (z.B. `https://sportoase-app.onrender.com`)\n2. Melden Sie sich mit den Admin-Zugangsdaten an\n3. Prüfen Sie, ob alles funktioniert\n\n## E-Mail-Konfiguration (optional)\n\nFür E-Mail-Benachrichtigungen bei Buchungen können Sie einen SMTP-Service verwenden:\n\n### Gmail SMTP (für Tests):\n- Host: `smtp.gmail.com`\n- Port: `587`\n- User: Ihre Gmail-Adresse\n- Pass: App-spezifisches Passwort (nicht Ihr normales Passwort!)\n\n[Anleitung für Gmail App-Passwort](https://support.google.com/accounts/answer/185833)\n\n### Professionelle Services:\n- SendGrid (kostenlos bis 100 E-Mails/Tag)\n- Mailgun\n- Amazon SES\n\n## Wichtige Hinweise\n\n1. **Free Tier**: \n   - Web Service schläft nach 15 Min Inaktivität\n   - Erste Anfrage dauert 30-60s zum Aufwachen\n   - PostgreSQL läuft nach 90 Tagen ab (Backup erforderlich!)\n\n2. **Datenbank-Backup**:\n   ```bash\n   pg_dump DATABASE_URL > backup.sql\n   ```\n\n3. **Logs überwachen**:\n   - Render Dashboard → Ihre App → Logs\n   - Hilft bei der Fehlersuche\n\n4. **Updates deployen**:\n   - Pushen Sie zu GitHub\n   - Render deployt automatisch\n   - **Nach größeren Datenbank-Änderungen**: Führen Sie `python db_setup.py` erneut aus\n\n## Troubleshooting\n\n### App startet nicht:\n- Prüfen Sie die Logs in Render Dashboard\n- Stellen Sie sicher, dass `DATABASE_URL` mit `postgresql://` beginnt\n- Überprüfen Sie, ob alle Pakete in `requirements.txt` sind\n\n### Datenbank-Verbindungsfehler:\n- Verwenden Sie die **Internal Database URL** (nicht External)\n- Bestätigen Sie, dass die Datenbank \"Available\" ist\n- Prüfen Sie, ob Region von App und DB übereinstimmt\n- **Wichtig**: Haben Sie `python db_setup.py` ausgeführt?\n\n### \"Tabelle existiert nicht\" Fehler:\n- Sie haben vergessen, `python db_setup.py` auszuführen!\n- Verbinden Sie sich mit der Shell und führen Sie das Skript aus\n\n### E-Mails werden nicht gesendet:\n- Überprüfen Sie SMTP-Einstellungen in den Umgebungsvariablen\n- Testen Sie SMTP-Zugangsdaten lokal\n- Prüfen Sie, ob Port 587 erlaubt ist\n- Für Gmail: Verwenden Sie ein App-spezifisches Passwort\n\n## Lokale Entwicklung\n\nFür die lokale Entwicklung:\n\n1. Installieren Sie PostgreSQL lokal\n2. Erstellen Sie eine `.env` Datei:\n   ```\n   DATABASE_URL=postgresql://localhost:5432/sportoase_dev\n   SESSION_SECRET=dev-secret-key\n   ADMIN_EMAIL=sportoase.kg@gmail.com\n   ```\n3. Führen Sie aus:\n   ```bash\n   python db_setup.py\n   uv run python app.py\n   ```\n\n## Support\n\nBei Fragen zu Render: https://render.com/docs\n","size_bytes":5219}},"version":2}