{% extends "base.html" %}

{% block title %}Buchung - SportOase{% endblock %}

{% block content %}
<div class="booking-container">
    <div class="booking-header-card">
        <h2>‚úì Neue Buchung</h2>
        <p class="booking-subtitle">F√ºllen Sie das Formular aus, um Ihre Buchung abzuschlie√üen</p>
    </div>
    
    <div class="booking-info-card">
        <div class="info-grid">
            <div class="info-item">
                <span class="info-icon">üìÖ</span>
                <div class="info-content">
                    <span class="info-label">Datum</span>
                    <span class="info-value">{{ date_str }}</span>
                </div>
            </div>
            <div class="info-item">
                <span class="info-icon">üïê</span>
                <div class="info-content">
                    <span class="info-label">Stunde</span>
                    <span class="info-value">{{ period }}. ({{ period_time.start }} - {{ period_time.end }})</span>
                </div>
            </div>
            <div class="info-item">
                <span class="info-icon">üéØ</span>
                <div class="info-content">
                    <span class="info-label">Angebot</span>
                    <span class="info-value">
                        {% if period_info.type == 'fest' %}
                        <span class="badge badge-fest">FEST: {{ period_info.label }}</span>
                        {% else %}
                        <span class="badge badge-frei">FREI (Modulwahl m√∂glich)</span>
                        {% endif %}
                    </span>
                </div>
            </div>
            <div class="info-item">
                <span class="info-icon">üë•</span>
                <div class="info-content">
                    <span class="info-label">Verf√ºgbare Pl√§tze</span>
                    <span class="info-value capacity-indicator">{{ available_spots }} / 5</span>
                </div>
            </div>
        </div>
    </div>
    
    <form method="POST" id="bookingForm" class="booking-form-modern">
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
        <div class="form-card teacher-card">
            <div class="card-header">
                <span class="card-icon">üë®‚Äçüè´</span>
                <h3>Ihre Angaben</h3>
            </div>
            <div class="card-body">
                <div class="form-row">
                    <div class="form-group">
                        <label for="teacher_name">Ihr Name</label>
                        <input type="text" id="teacher_name" name="teacher_name" required placeholder="z.B. Max Mustermann">
                    </div>
                    
                    <div class="form-group">
                        <label for="teacher_class">Ihre Klasse</label>
                        <input type="text" id="teacher_class" name="teacher_class" required placeholder="z.B. 5a">
                    </div>
                </div>
            </div>
        </div>
        
        <div class="form-card students-card">
            <div class="card-header">
                <span class="card-icon">üë•</span>
                <h3>Sch√ºler-Informationen</h3>
            </div>
            <div class="card-body">
                <div class="form-group">
                    <label for="num_students">Anzahl Sch√ºler (1-5)</label>
                    <select id="num_students" name="num_students" onchange="updateStudentFields()" required>
                        <option value="1">1 Sch√ºler</option>
                        <option value="2">2 Sch√ºler</option>
                        <option value="3">3 Sch√ºler</option>
                        <option value="4">4 Sch√ºler</option>
                        <option value="5">5 Sch√ºler</option>
                    </select>
                </div>
                
                <div id="studentFields" class="student-fields-container">
                    <!-- Wird dynamisch mit JavaScript gef√ºllt -->
                </div>
            </div>
        </div>
        
        {% if period_info.type == 'frei' %}
        <div class="form-card module-card">
            <div class="card-header">
                <span class="card-icon">üìö</span>
                <h3>Modul-Auswahl</h3>
            </div>
            <div class="card-body">
                <div class="form-group">
                    <label for="module">W√§hlen Sie ein Modul</label>
                    <select id="module" name="module" required>
                        <option value="">-- Bitte w√§hlen --</option>
                        {% for module in free_modules %}
                        <option value="{{ module }}">{{ module }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
        </div>
        {% endif %}
        
        <div class="form-actions-modern">
            <a href="{{ url_for('dashboard', date=date_str) }}" class="btn btn-secondary">
                <span>‚Üê</span> Abbrechen
            </a>
            <button type="submit" class="btn btn-primary btn-large">
                <span>‚úì</span> Buchung abschlie√üen
            </button>
        </div>
    </form>
</div>

<script>
function updateStudentFields() {
    const numStudents = parseInt(document.getElementById('num_students').value);
    const container = document.getElementById('studentFields');
    container.innerHTML = '';
    
    for (let i = 0; i < numStudents; i++) {
        const div = document.createElement('div');
        div.className = 'student-entry-modern';
        div.innerHTML = `
            <div class="student-number">Sch√ºler ${i + 1}</div>
            <div class="form-row">
                <div class="form-group">
                    <label for="student_name_${i}">Name</label>
                    <input type="text" id="student_name_${i}" name="student_name_${i}" required placeholder="Name des Sch√ºlers">
                </div>
                <div class="form-group">
                    <label for="student_class_${i}">Klasse</label>
                    <input type="text" id="student_class_${i}" name="student_class_${i}" required placeholder="z.B. 5a">
                </div>
            </div>
        `;
        container.appendChild(div);
    }
}

// Initialisiere mit 1 Sch√ºler
updateStudentFields();
</script>
{% endblock %}
